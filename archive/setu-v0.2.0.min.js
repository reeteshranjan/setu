!function(e,t){function n(e){return"[object Array]"===Object.prototype.toString.call(e)}function r(e){return"object"==typeof e&&!n(e)}function a(){}function i(e){bn[e]&&(En=bn[e]);for(e in bn)bn[e]<=En?console[e]=console[e]||a:console[e]=a;console.group=console.group&&a!==console.info?console.group:a,console.groupEnd=console.groupEnd&&a!==console.info?console.groupEnd:a,An=console.time&&a!==console.error?console.time:a,wn=console.timeEnd&&a!==console.error?console.timeEnd:a,console.time=console.time&&a!==console.info?console.time:a,console.timeEnd=console.timeEnd&&a!==console.info?console.timeEnd:a,kn=console.info,Sn=console.warn,Tn=console.error}function o(e){return new Date(e).toLocaleString()}function u(e,t,n,r,a){n=n||{},n.type=e||"GET",n.async=n.async||!0,n.cache=n.cache||!1,n.url=t,n.beforeSend=n.beforeSend||function(e,t){m("ajax.beforeSend",e,t,this)},n.success=function(e,n,a){r&&r({data:e,status:n,xhr:a,url:t})},n.error=function(n,r,i){Tn("Setu.http ajax !",t,e,r,i),a&&a(Error(JSON.stringify({status:r,error:i,url:t,text:n.responseText})))},$.ajax(n)}function c(e,t,n,r){return u("GET",e,t,n,r)}function s(e,t,n,r){return u("POST",e,t,n,r)}function l(e,t,n,r){return u("PATCH",e,t,n,r)}function f(e,t,n,r){return u("PUT",e,t,n,r)}function d(e,t,n,r){return u("DELETE",e,t,n,r)}function p(e,t,n){jn[e]=jn[e]||[],jn[e].push([n,t])}function m(e){if(!jn[e])return[];var t=Array.prototype.slice.apply(arguments),n=[];return jn[e].forEach(function(e){t[0]=e[0],n.push(e[1].apply(null,t))}),n}function h(e,t,n){Cn[e].contains(n)||(Cn[e].push(n),Cn[e].push(t))}function v(e,t,n,r){Ln[e][t]=Ln[e][t]||[],Ln[e][t].contains(r)||(Ln[e][t].push(r),Ln[e][t].push(n))}function _(e,t,n){for(var r=Cn[e],a=0;a<r.length;a+=2)try{r[a+1](r[a],t,n)}catch(i){kn("Setu.events !",e,t,n,i.message,i.stack)}}function g(e,t,n,r){var a=Ln[e][t];if(a)for(var i=0;i<a.length;i+=2)try{a[i+1](a[i],n,r)}catch(o){kn("Setu.events !",e,t,n,r,o.message,o.stack)}}function y(e,t){Cn[e].remove(t,2)}function b(e,t,n){Ln[e][t].remove(n,2)}function E(e,t,n,r){Nn=r||{trailingSlash:!0,nameResolution:"Setu.models.NameResolutionDefault",urlPrefix:""},On=t||{},$n=n||{},zn=eval(Nn.nameResolution),w(e)}function A(e){if(!Fn[e])throw Tn("Setu.models !",e,"not defined by application"),new TypeError(__badly_configured_msg__);return Fn[e]}function w(e){for(var t in e){var r={},a=0,i=e[t];if(i.__dirty__||i.__model||i.__key)throw Tn("Setu.models","restricted keywords __dirty__, __model, and __key cannot be used as model fields"),new TypeError(__badly_configured_msg__);for(var o in i){var u=i[o];if("string"==typeof u){if(!e[u])throw Tn("Setu.models","model",t,"refers to",u,"model; but no specification for the latter provided"),new TypeError(__badly_configured_msg__)}else{if(!n(u))throw Tn("Setu.models","model",t,"field",o,"invalid specification",u),new TypeError(__badly_configured_msg__);if(!Ot.contains(u[0]))throw Tn("Setu.models","model",t,"field",o,"has an unidentified type",u[0]),new TypeError(__badly_configured_msg__);if("array"===u[0]&&u[1].match(/^[a-z]/)&&!$t.contains(u[1]))throw Tn("Setu.models","model",t,"field",o,"is an array of unsupported type of elements",u[1]),new TypeError(__badly_configured_msg__);u.contains("primaryKey")&&(a++,r.primaryKey=o)}}if(1!==a)throw Tn("Setu.models","model",t,"exactly one primary key needs to be specified"),new TypeError(__badly_configured_msg__);r.name=t,r.pathPrefix=Nn.urlPrefix+"/"+zn.m2p(r.name),r.spec=i,r.instanceType=k(r),Fn[t]=r}}function k(e){var n={};for(var r in e.spec)n[r]={get:function(e){return function(){return this["__"+e]}}(r),set:function(e){return function(t){var n=this["__"+e];if(this["__"+e]=t,n!==t){if(!this.__created||this.__dontFireChange)return;C(this,e,n,t)}}}(r),enumerable:!0},n["__"+r]={enumerable:!1,configurable:!1,writable:!0,value:t};return n}function S(e){var t=Object.create(Object.prototype,e.instanceType);return t.__model=e,t.__dirty__={},t}function T(e,t,n,r){t||(t="");var a=e.pathPrefix+(t||Nn.trailingSlash?"/":"")+(t?"?"+t:"");c(a,{},function(t){var r=m("models.listOutput",t)[0],a=[];r.list.forEach(function(t){var n=S(e);j(n,t),a.push(n)}),n(a)},function(e){r&&r([])})}function x(e,t,n,r){var a=e.pathPrefix+"/"+t+(Nn.trailingSlash?"/":"");c(a,{},function(t){var r=t.data,a=S(e);j(a,r),n(a)},function(e){r&&r({})})}function j(e,t){if(t){var n=e.__model.spec;for(var r in t)n[r]&&(e[r]=t[r]);e.__created=!0,e.__key=e.__model.name+"|"+e[e.__model.primaryKey],ie(e)}}function C(e,t,n,r){e.__dirty__[t]=!0,g(mn,e.__key,e,{field:t,oldVal:n,newVal:r})}function L(e,n){var r=On[e.__model.name];return r&&r[n]?r[n](e):t}function F(e,t,n){return e.__created?N(e,t,n):O(e,t,n)}function O(e,t,n){if(e.__created)return Tn("Setu.instances","internal programming error or user forced create of an already created instance",e),void t(e);var r=e.__model.pathPrefix+(Nn.trailingSlash?"/":""),a={};for(var i in e.__model.spec)"string"!=typeof e.__model.spec[i]&&e.__model.spec[i].contains("auto")||(a[i]=e[i]);s(r,{data:JSON.stringify(a),contentType:Ct},function(n){var r=n.data;j(e,r),g(hn,e.__model.name,e),t(e)},function(e){n&&n({},e)})}function N(e,t,n){if(!e.__created)return Tn("Setu.instances","internal programming error or user forced update of an instance that does not exist in backend",e),void t(e);var r=e.__model.pathPrefix+"/"+e[e.__model.primaryKey]+(Nn.trailingSlash?"/":""),a={};for(var i in e.__dirty__)a[i]=e[i];l(r,{data:JSON.stringify(a),contentType:Ct},function(n){var r=n.data;e.__dontFireChange=!0;for(var a in r)e.__model.spec[a]&&(e[a]=r[a]);e.__dirty__={},e.__dontFireChange=!1,g(_n,e.__model.name,e),t(e)},function(e){n&&n({},e)})}function z(){for(var e in Zn)delete Pn[e];Zn={},Rn=t}function P(e,t){Pn[e]=t,Zn[e]=!0,"event"===e&&(Rn=t)}function Z(e){return Pn[e]}function R(e){for(var t in e){var n=e[t];Pn[t]=n,Zn[t]=!0,"event"===t&&(Rn=n)}}function M(e,n){!e.event&&Rn&&Pn.event!==Rn&&(Pn.event=Rn),R(e);var r=n.replace(Zt,function(e){var n=e.replace(/[{}]/g,"").replace(/\s*\|\s*/,"|");parts=n.split("|");try{var r=eval(parts[0]);if(t===r)return e;for(var a=1;a<parts.length;++a){var i=parts[a];if(r=xn[i]?xn[i](r):r[eval(i)],t===r)return e}return r}catch(o){return e}});return D(Object.keys(e)),r}function q(e,t){!e.event&&Rn&&Pn.event!==Rn&&(Pn.event=Rn),R(e);var n;try{n=t.match(Zt)?eval(M({},t)):eval(t)}catch(r){return t}return D(Object.keys(e)),n}function D(e){e.forEach(function(e){Pn[e]&&(Pn[e]=t),Zn[e]=t,"event"===e&&(Rn=t)})}function H(e){e.registered||(v(hn,e.model.name,K,e),v(_n,e.model.name,U,e),v(vn,e.model.name,B,e),e.registered=!0)}function I(e){e.registered&&(b(hn,e.model.name,e),b(_n,e.model.name,e),b(vn,e.model.name,e),e.registered=!1)}function K(e,t){Q(e,t)&&J(e,t)}function U(e,t){var n=Q(e,t),r=e.value.contains(t);n&&!r?J(e,t,!0):!n&&r&&G(e,t,!0)}function B(e,t){e.value.contains(t)&&G(e,t)}function Q(e,t){if(e.params)for(var n in e.params)if(t[n]){if(e.params[n]!=t[n])return!1}else if(e.params[n]!=L(t,n))return!1;return!0}function J(e,t,n){e.value.unshift(t),e.value.length>1?n?Et():g(ln,e.key,e):n?Et():_(sn,e)}function G(e,t,n){e.value.remove(t),n?Et():g(ln,e.key,e)}function V(e){e.registered||(v(mn,e.value.__key,W,e),v(vn,e.value.__key,Y,e),e.registered=!0)}function X(e){e.registered&&(b(mn,e.value.__key,e),b(vn,e.value.__key,e),e.registered=!1)}function W(e,t,n){n.key=e.key,g(fn,e.key,e,n)}function Y(e){}function ee(e){qn=e,Mn={}}function te(e){if(!e||!e.length)return!1;var t={};return e.every(function(e){var n,r=e.title;return(n=Mn[e.key])&&n.value?(t[r]=n.value,!0):(t=!1,!1)}),t}function ne(e,t,n){if(!e||!e.length)return void n({});var r={};e.forEach(function(a){var i="string"==typeof a?se(t,a):a,o=i.title;Mn[i.key]?i=Mn[i.key]:Mn[i.key]=i,le(o,i,function(t){r[t.title]=t.value,Object.keys(r).length===e.length&&n(r)})})}function re(e){Mn[e]&&(ce(Mn[e]),delete Mn[e])}function ae(){for(var e in Mn)ce(Mn[e]),delete Mn[e]}function ie(e){if(!Mn[e.__key]){var t={type:rn,key:e.__key,title:zn.m2i(e.__model.name),model:e.__model,pk:e[e.__model.primaryKey],value:e};V(t),Mn[e.__key]=t}}function oe(e,n){var r,a;if(n.match(Zt))try{n=M(e,n)}catch(i){}if(r=(a=n.match(zt))?{title:a[1],model:A(a[2]),params:a[3],key:a[2]+"|"+a[3]}:(a=n.match(Pt))?{title:n,model:A(a[1]),params:a[2],key:n}:{title:n,model:A(n),key:n},!r.params||r.params.match(/=/))r.type=nn,r.title===n&&(r.title=zn.m2l(r.model.name));else{if(!r.params)throw Tn("Setu.resources !","invalid instance key",n),new TypeError(__invalid_meta_msg__);r.type=rn,r.title===n&&(r.title=zn.m2i(r.model.name)),r.pk=r.params,r.params=t}return r}function ue(e){return nn===e.type?zn.m2l(e.model.name):rn===e.type?zn.m2i(e.model.name):t}function ce(e){nn===e.type?I(e):rn===e.type&&X(e)}function se(e,t){var n=qn[t];if(n)return{type:"api",key:t,title:t,api:n};var r=oe(e,t);if(nn===r.type&&r.params){r.queryparams=r.params.replace(/;/,"&");var a=r.params.split(";");r.params={},a.forEach(function(e){var t=e.split("=");r.params[t[0]]=t[1]})}return r}function le(e,n,r){switch(n.type){case nn:n.value?r({title:e,value:n.value}):T(n.model,n.queryparams,function(t){$n[n.model.name]&&$n[n.model.name].list&&"function"==typeof $n[n.model.name].list&&(t=$n[n.model.name].list(t)),n.value=t,H(n),r({title:e,value:n.value})},function(t){r({title:e,value:t})});break;case rn:n.value?r({title:e,value:n.value}):x(n.model,n.pk,function(t){n.value=t,V(n),r({title:e,value:n.value})},function(t){r({title:e,value:t})});break;case"api":n.value?r({title:e,value:n.value}):c(n.api,{},function(t){n.value=t.data,r({title:e,value:n.value})},function(n){r({title:e,value:t})})}}function fe(e){return pe(e)||de(e)||me(e).length}function de(e){return e.outerHTML&&e.outerHTML.match(Zt)}function pe(e){if(e.hasAttribute)for(var t=0;t<tn.length;++t)if(e.hasAttribute(tn[t]))return!0;return!1}function me(e){var t=e.querySelectorAll(yn),n=[];return t.forEach(function(e){n.push(e)}),n}function he(e){var t=e.getAttribute(Kt);if(!t)return null;var n;return-1!==[rn,on].indexOf(t)?{type:t}:(n=t.match(Dt))?{type:nn,modelName:n[2]||n[6],filter:n[3]||n[7]}:(n=t.match(Ht))?{type:an,modelName:n[2]}:{type:"generic",code:t}}function ve(e){if(e.hasAttribute(Vt))return{type:un,model:A(e.getAttribute(Vt))};if(e.hasAttribute(Jt)){var t=e.getAttribute(Jt),n=se(e.setu.needed,t);if(rn!==n.type)throw Tn("Setu.meta !","invalid instance key",t,e),new TypeError(__invalid_meta_msg__);return{type:cn,resource:n}}return null}function _e(e){return ye(e,It)}function ge(e){return ye(e,Wt)}function ye(e,t){if(!e.hasAttribute||!e.hasAttribute(t))return[];for(var n=e.getAttribute(t).split(","),r=0;r<n.length;++r){var a=se(e.setu.needed,n[r]);if(nn!==a.type&&rn!==a.type)throw Tn("Setu.meta !","invalid key",t,n[r],e),new TypeError(__invalid_meta_msg__);n[r]=a}return n}function be(e,t){var n=document.createElement(e.parentElement.tagName);n.innerHTML=t,e.parentElement.insertBefore(n.firstElementChild,e),n.remove();var r=e.setu;return e=e.previousElementSibling,e.setu=r,ke(e.nextElementSibling),e.setu.parent&&e.setu.parent.children.push(e),e}function Ee(e,t){if(e.setu.needed[e.setu.contextKey]=t,e.outerHTML.match(Zt)){var n=document.createElement(e.parentElement.tagName);n.innerHTML=M(e.setu.needed,e.outerHTML),e.parentElement.insertBefore(n.firstElementChild,e),n.remove()}else e.parentElement.insertBefore(e.cloneNode(!0),e);var r=e.previousElementSibling;return r.removeAttribute(Gt),Ce(e,r),r}function Ae(e){var t=e.setu;if(!t)throw new Error(__internal_error_msg__);var n=document.createElement(e.parentElement.tagName);n.innerHTML=M(t.needed,t.template),e.parentElement.insertBefore(n.firstElementChild,e),n.remove();var r=e.previousElementSibling;return e.classList.forEach(function(e){r.classList.add(e)}),Ce(e,r),r}function we(e){e.setu=e.setu||{},e.setu.key=Dn,++Dn}function ke(e){var t=e.setu;if(t.children&&t.children.length){var n=t.children.slice();n.forEach(function(e){ke(e)}),delete t.children}t.parent&&(t.parent.setu.children.remove(e),delete t.parent),g(pn,t.key,e),e.remove()}function Se(e){e.forEach(function(e){e.setu?ke(e):e.remove()})}function Te(e,t){t.setuEvalingParent=!1,t.setu=t.setu||{},t.setu.needed=t.setu.needed||{};var n=e.setu.needed,r=t.setu.needed;for(var a in n)r[a]=n[a];t.setu.contextKey=e.setu.contextKey,t.setu.parent=e}function xe(e){var t={};return t.parent=e.parentElement,t.index=$(e).index(),t.data=e.outerHTML,t.setu=e.setu,ke(e),t}function je(e){if(null!==e.parent.parentElement){e.index>0?$(e.parent).children().eq(e.index-1).after(e.data):$(e.parent).prepend(e.data);var t=$(e.parent).children()[e.index];t.setu=e.setu;for(var n=t.parentElement;n&&!n.setu;)n=n.parentElement;return n&&(n.setu.children=n.setu.children||[],n.setu.children.push(t),t.setu.parent=n),t}}function Ce(e,t){var n=t.setu={needed:{}},r=e.setu;for(var a in r)if("needed"===a)for(var i in r.needed)n.needed[i]=r.needed[i];else"children"!==a&&(n[a]=r[a]);r.parent&&r.parent.setu.children.push(t)}function Le(){Hn=[],In=[],Kn=!1,Un=0,Bn=0,Qn=!1}function Fe(){if(!Kn){if(!In.length)return void(Un||Bn||Oe());Kn=!0,Bn&&--Bn;for(var t=In.shift();t;)t.setuQueued=!1,Ne(t),t=In.shift();if(Un||Bn)return void(Kn=!1);Kn=!1,_("MetaRender",e),Oe()}}function Oe(){Qn||(Qn=!0,Ze(),_("PageRender",e))}function $e(e){var t=new RegExp("[^a-zA-Z0-9_]"+e+"[^a-zA-Z0-9_]",""),n=[],r=[];return Hn.forEach(function(e){e.data&&e.data.match(t)?n.push(je(e)):r.push(e)}),Hn=r,n}function Ne(e){if(null!==e.parentNode&&!e.setuEvalingParent){var t=me(e);t.forEach(function(e){e.setuEvalingParent=!0});var n=e.setu=e.setu||{};if(n.needed=n.needed||{},e.hasAttribute(Qt))return++Un,void c(e.getAttribute(Qt),{},function(t){--Un,e.hasAttribute(Yt)?e=t.data.match(Zt)?be(e,M(e.setu.needed,t.data)):be(e,t.data):(t.data.match(Zt)?e.innerHTML=M(e.setu.needed,t.data):e.innerHTML=t.data,e.removeAttribute(Qt),fe(e)&&(In.push(e),e.setuQueued=!0),Fe())});if(e.hasAttribute(Wt)&&!n.doneRequire){var r,a=ge(e);if(!(r=te(a)))return++Un,void ne(a,{},function(t){for(var r in t)n.needed[r]=t[r];n.doneRequire=!0,In.push(e),e.setuQueued=!0,--Un,Fe()});for(var i in r)n.needed[i]=r[i];n.doneRequire=!0}if(e.hasAttribute(It)&&!e.setu.template)if(e.hasAttribute(Gt)){var o=e.getAttribute(Gt);e.removeAttribute(Gt),n.template=e.outerHTML,$(e).attr(Gt,o)}else n.template=e.outerHTML;var u;if(e.hasAttribute(Gt)&&(u=e.getAttribute(Gt).match(Mt))){var s=u[1],l=u[2];try{l=q(n.needed,l)}catch(f){return}return e.setu.contextKey=s,l.forEach(function(t){Ee(e,t)}),l.length&&fe(e.previousElementSibling)&&(Bn=1),Se(t),void ke(e)}if(e.hasAttribute(Bt)){var d=e.getAttribute(Bt),p=!1;try{p=q(n.needed,d)}catch(f){return}if(!p)return void Hn.push(xe(e))}if(e.hasAttribute(Ut)&&(u=e.getAttribute(Ut).match(qt))){var m=u[1],h=u[2];try{h=q(n.needed,h)}catch(f){return}n.needed[m]=h}if(e.outerHTML.match(Zt)){R(n.needed),e.innerHTML.match(Zt)&&(tt(),e.innerHTML=M({},e.innerHTML),Se(t),et(),t=me(e));for(var v=0;v<e.attributes.length;++v){var _=e.attributes[v];_.value.match(Zt)&&(_.value=M({},_.value))}D(Object.keys(n.needed))}we(e),t.forEach(function(t){Te(e,t),t.setuQueued||(In.push(t),t.setuQueued=!0)}),t.length&&(n.children=t),e.hasAttribute(Kt)&&at(e),"form"===e.tagName.toLowerCase()&&ze(e),e.hasAttribute(en)&&Me(e),e.hasAttribute(It)&&De(e)}}function ze(e){null!==e.parentNode&&(e.setuForm||h("MetaRender",function(e){y("MetaRender",e),e.querySelectorAll("select").forEach(function(e){var t=e.querySelector("option[selected]");t&&(e.value=t.value)});var t=ve(e);if(t)switch(t.type){case un:Pe(e,S(t.model));break;case cn:var n,e=e;(n=te([t.resource]))?Pe(e,n[Object.keys(n)[0]]):ne([t.resource],{},function(t){Pe(e,t[Object.keys(t)[0]])})}},e))}function Pe(e,t){e.setuInstance=t,m("forms.setup",e),e.setuForm=!0}function Ze(){Re(),document.querySelectorAll("form").forEach(function(e){e.querySelectorAll("select").forEach(function(e){var t=e.querySelector("option[setu-selected]");t&&(t.setAttribute("selected","selected"),t.removeAttribute("setu-selected"),e.value=t.value)}),e.querySelectorAll("input[setu-checked]").forEach(function(e){e.setAttribute("checked","checked"),e.removeAttribute("setu-checked")})})}function Re(){sr.querySelectorAll("a[href]").forEach(function(e){if(e.setuLink)return!0;var t=e.getAttribute("href").replace(/\?.*$/,"");Xn[t]&&$(e).unbind("click").click(function(t){return t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),At(e.getAttribute("href")),!1}),e.setuLink=!0})}function Me(e){var t=e.getAttribute(en);m("chart.render",t,e)}function qe(){Jn={},Gn=[],Vn=!1}function De(t){if(t.setuBind)return!0;var n=t.setu;if(!n)return void Tn("Setu.binds","internal programming error with binds",t);var r=_e(t);r.forEach(function(r){var a=r.key;Jn[a]=Jn[a]||{},Jn[a][n.key]||(Jn[a][n.key]=t,1===Object.keys(Jn[a]).length&&(rn===r.type?v(fn,a,Ie,e):nn===r.type&&v(ln,a,Ue,e)))}),v(pn,n.key,He,e),t.setuBind=!0}function He(t,n){var r=n.setu,a=_e(n);a.forEach(function(t){var n=t.key;Jn[n][r.key]&&(delete Jn[n][r.key],0===Object.keys(Jn[n]).length&&(rn===t.type?b(fn,n,e):nn===t.type&&b(ln,n,e)))}),b(pn,r.key,e)}function Ie(e,t,n){if(!Qe(Ie,e,t,n)){var r=n.key,a=n.field;if(!Jn[r])return void Je();var i=Jn[r]?Object.keys(Jn[r]).slice():[],o=[];if(i.forEach(function(e){var t=Jn[r][e],n=new RegExp("\\."+a+"[^a-zA-Z0-9_]","g");t.setu.template.match(n)&&o.push(e)}),!o.length)return void Je();Be(r,o),Je()}}function Ke(e,t){var n=t.key,r=Jn[n]?Object.keys(Jn[n]).slice():[];r.length?Be(n,r):$e(t.title||ue(t))}function Ue(e,t){var n=t.key;if(Jn[n]){var r=Jn[n]?Object.keys(Jn[n]).slice():[];Be(n,r)}}function Be(e,t){t.forEach(function(t){var n=Jn[e][t];Ae(n),ke(n)})}function Qe(e,t,n,r){return Vn?(Gn.push([e,t,n,r]),!0):(Vn=!0,!1)}function Je(){Vn=!1;var e=Gn.shift();e&&e[0](e[1],e[2],e[3])}function Ge(e){Xn=e,Xe()}function Ve(e){if(er&&er.path?(Yn=er.path.replace(/\?.*$/,""),er=null):Yn=location.pathname,!Xn[Yn])return Wn={},void e();var t=Xn[Yn];"function"==typeof t?t(function(t){Wn=t,e()}):(Wn=t,e())}function Xe(){Wn=Yn=t}function We(e){history.pushState({path:e},"",e)}function Ye(e){history.replaceState({path:e},"",e)}function et(){sr&&sr.parentNode&&tr.observe(sr,{childList:!0,subtree:!0})}function tt(){tr.disconnect()}function nt(e){var t=!1;e.forEach(function(e){if(e.addedNodes&&e.addedNodes.length)for(var n=0;n<e.addedNodes.length;++n){var r=e.addedNodes[n];Lt==r.nodeType&&fe(r)&&(In.push(r),r.setuQueued=!0,t=!0)}}),!Kn&&t&&Fe()}function rt(e){nr=e}function at(e){if(!e.setuClick){var t=he(e);if(null===t)throw Tn("Setu.views ! invalid setu-click",e.getAttribute(Kt),e),new Error(__invalid_meta_msg__);switch(t.type){case rn:case on:it(e,t);break;case an:case nn:ot(e,t);break;case"generic":e.onclick=function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),eval(t.code)},e.setuClick=!0}}}function it(e,t){var n=e.setu;if(!n)return void Tn("Setu.views ! internal programming error blocked processing setu-click",e);var r=n.needed[n.contextKey];if(!r)throw Tn("Setu.views ! setu-click specified on an element for which no instance context can be found",e),new Error(__invalid_meta_msg__);var a=r.__model.name;if(nr[a]&&nr[a][t.type]){var i=ut(e,a,t);t.instance=r,ct(e,t,i)}}function ot(e,t){var n=t.modelName;if(nr[n]&&nr[n][t.type]){var r=ut(e,n,t);ct(e,t,r)}}function ut(e,t,n){var r=nr[t][n.type];if("function"!=typeof r)throw Tn("Setu.views ! not a view function",t,n.type,r),new Error(__badly_configured_msg__);return n.passed=e.getAttribute(Xt),n.origin=e,r}function ct(e,t,n){$(e).unbind("click").click(function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),n(t)}),e.setuClick=!0}function st(e){rr=e,rr.logLevel&&i(rr.logLevel),rr.adapters&&rr.adapters.forEach(function(e){yt(e)}),rr.charts&&m("chart.config",rr.charts)}function lt(){return rr.pathchange&&rr.pathchange.flush?rr.pathchange.flush:t}function ft(e,t,n,r){if(!/^(GET|HEAD|OPTIONS|TRACE)$/.test(n.type)&&!r.crossDomain){var a=document.cookie.match(new RegExp("csrftoken=([^;]+)"));a&&t.setRequestHeader("X-CSRFToken",a[1])}}function dt(e,a){var i=a.data;return r(i)?{available:i.count,nextPage:i.next,prevPage:i.previous,list:i.results}:n(i)?{available:t,nextPage:null,prevPage:null,list:i}:void 0}function pt(e){$(e).find("[type=submit],label[for]").each(function(){var e=$(this).html();$(this).html('<i class="fa fa-circle-o-notch fa-spin fa-fw"></i>'+e)})}function mt(e){$(e).find("[type=submit],label[for]").each(function(){$(this).find("i.fa.fa-circle-o-notch").remove()})}function ht(e,t){var n=$(t).data("finre")?$(t).data("finre"):new finre.forms.Form(t);t.onsubmit=function(e,t){return function(){try{if(e.controls.forEach(function(e){$(e.element).change()}),!e.forceSubmit){var n=e.onsubmit();if(!n)return e.controls.every(function(e){return e.in_error?($("html,body").animate({scrollTop:e.getTop()-40},400),!1):void 0}),!1}return pt(t),F(t.setuInstance,function(e){mt(t),_("FormSuccess",t,e)},function(e,n){mt(t),Tn("Setu.adpaters.finre ! submit",t);var r=JSON.parse(n.message);_("FormError",t,r)}),!1}catch(r){return kn("Setu.adpaters.finre",r.message,r.stack),!1}}}(n,t),n.controls.forEach(function(e){e.registerOnvalid(function(e,t){e[t.element.name]=t.value()},t.setuInstance)})}function vt(e,t){for(var n in t)Chart.defaults.global[n]=t[n]}function _t(e,t,n){var r=t.split(" ");if(!r.length)throw Tn("Setu.adapters.chartjs ! invalid setu-chart",n.getAttribute(en),n),new Error(__invalid_meta_msg__);var a=r[0];switch(a){case ar:gt(r,n);break;default:throw Tn("Setu.adapters.chartjs ! unsupported chart type",a,n.getAttribute(en)),new Error(__unsupported_error_msg__)}}function gt(e,n){var r={};e.forEach(function(e,t){if(t){if(!e.match(/:/))throw Tn("Setu.adapters.chartjs ! invalid chart argument",e,n.getAttribute(en)),new Error(__invalid_meta_msg__);var a=e.split(":");r[a[0]]=a[1]}}),ir.forEach(function(e){if(!r[e])throw Tn("Setu.adapters.chartjs ! missing donut percentage chart arg",e,n.getAttribute(en)),new Error(__invalid_meta_msg__);switch(e){case"percentage":var a=parseFloat(q(n.setu.needed,r[e]));if(isNaN(a))throw Tn("Setu.adapters.chartjs ! donut-percentage bad percentage arg",r[e],n.getAttribute(en)),new Error(__invalid_meta_msg__);a=a.toFixed(2),r[e]=a;break;case"color":var i=r[e],o;if(i.match(/^#/))o=i;else if(i.match(/^from_percentage/)){var u;if(!(u=i.match(ur)))throw Tn("Setu.adapters.chartjs ! donut-percentage bad from_percentage color spec",r[e],n.getAttribute(en)),new Error(__invalid_meta_msg__);var c=eval(u[1]),s=eval(u[2]),l="#";if(t===r[e])throw Tn("Setu.adapters.chartjs ! internal programming error"),new Error(__internal_error_msg__);for(var f=0;3>f;++f){var d=(Math.round((s[f]-c[f])*r.percentage/100)+c[f]).toString(16);1==d.length&&(d="0"+d),l+=d}}r[e]=l;break;case"height":var p=parseInt(r[e]);if(isNaN(p))throw Tn("Setu.adapters.chartjs ! donut-percentage bad height spec",r[e],n.getAttribute(en)),new Error(__invalid_meta_msg__);r[e]=p;break;case"width":var m=parseInt(r[e]);if(isNaN(m))throw Tn("Setu.adapters.chartjs ! donut-percentage bad width spec",r[e],n.getAttribute(en)),new Error(__invalid_meta_msg__);r[e]=m;break;case"labels":var h=r[e];if(!h.match(or))throw Tn("Setu.adapters.chartjs ! donut-percentage bad labels spec",r[e],n.getAttribute(en)),new Error(__invalid_meta_msg__);h=eval(h),r[e]=h}});var a=document.createElement("canvas");a.setAttribute("height",r.height),a.setAttribute("width",r.width),n.appendChild(a),a=n.querySelector("canvas"),new Chart(a,{type:"doughnut",data:{datasets:[{data:[r.percentage,100-r.percentage],labels:r.labels,backgroundColor:[r.color,"#ffffff"]}]}})}function yt(e){cr[e].forEach(function(e){p(e[0],e[1])})}function bt(e,t){fr=e,st(t.config||{}),Ge(t.routes||{}),E(t.models,t.modelFilters,t.modelProcessors,t.config&&t.config.models),ee(t.resources||{}),rt(t.views||{}),kt()}function Et(){jt(),kt()}function At(e){We(e),kt()}function wt(e){Ye(e),kt()}function kt(){St(),Tt()}function St(){var e=lt();for(var n in e)switch(n){case"resources":e[n].forEach(function(e){re(e)})}if(Xe(),Le(),qe(),z(),lr){for(var r=lr.previousElementSibling;r;){var a=r;r=r.previousElementSibling,a.remove()}lr=t}}function Tt(){Ve(function(){if(Wn.redirect)wt(Wn.redirect);else if(Wn.include){var e={};if(location.search){var t=location.search.replace(/^\?/,""),n=t.split("&");n.forEach(function(t){var n=t.split("=");e[n[0]]=n[1]})}P("queryparams",e),Wn.flush&&jt();var r=Wn.require||[];ne(r,{},function(e){R(e),et(),xt()})}else et(),me(sr).forEach(function(e){In.push(e),e.setuQueued=!0}),Fe()})}function xt(){c(Wn.include,{},function(e){lr=sr.firstElementChild,$(lr).before(e.data),me(sr).length||Oe()})}function jt(){ae()}var Ct="application/json; charset=UTF-8",Lt=1,Ft=8,Ot=["string","uuid","integer","decimal","datetime","boolean","array"],$t=["string","uuid","integer","decimal","datetime","boolean"],Nt=["Uuid","Integer","Object"],zt=/^{([a-z][0-9a-zA-Z_]+)}([A-Za-z][0-9a-zA-Z_]+)\|(.*)$/,Pt=/^([A-Za-z][0-9a-zA-Z_]+)\|(.*)$/,Zt=/({{[^{}]+}})/g,Rt=/^setu\-([a-z])([a-z]+)$/,Mt=/([a-zA-Z][a-zA-Z0-9_\.]*)[\s]*in[\s]*([a-zA-Z][a-zA-Z0-9_\.]+)/,qt=/([a-zA-Z][a-zA-Z0-9_]*)[\s]*=[\s]*(.*)+/,Dt=/(^(list):([A-Z][A-Za-z0-9_]+)$)|(^(list):([A-Z][A-Za-z0-9_]+)\|(.*)$)/,Ht=/^(create):([A-Z][A-Za-z0-9_]+)$/,It="setu-bind",Kt="setu-click",Ut="setu-declare",Bt="setu-if",Qt="setu-include",Jt="setu-instance",Gt="setu-loop",Vt="setu-model",Xt="setu-pass",Wt="setu-require",Yt="setu-replace",en="setu-chart",tn=[It,Kt,Ut,Bt,Qt,Jt,Gt,Vt,Xt,Wt,en],nn="list",rn="detail",an="create",on="update",un="model",cn="instance",sn="ListResourceCreate",ln="ListResourceChange",fn="DetailResourceChange",dn="DetailResourceDelete",pn="BeforeElementDelete",mn="InstanceChange",hn="InstanceCreate",vn="InstanceDelete",_n="InstanceSave";__badly_configured_msg__="Improperly configured Setu application",__invalid_meta_msg__="Invalid Setu meta syntax",__internal_error_msg__="Setu internal error",__unsupported_error_msg__="Unsupported feature";var gn=[];tn.forEach(function(e){gn.push("["+e+"]")});var yn=gn.join(",");Array.prototype.contains=function(e){return-1!==this.indexOf(e)},Array.prototype.remove=function(e,t){var n;-1!==(n=this.indexOf(e))&&this.splice(n,t||1)};var bn={error:1,warn:2,info:3,log:4,debug:5},En=5;console.debug=console.debug||a,console.log=console.log||a,console.group=console.group||a,console.groupEnd=console.groupEnd||a,console.time=console.time||a,console.timeEnd=console.timeEnd||a;var An=console.time||a,wn=console.timeEnd||a,kn=console.info||a,Sn=console.warn||a,Tn=console.error||a,xn={datetime:o},jn={},Cn={},Ln={};Cn[sn]=[],Cn.FormSuccess=[],Cn.FormError=[],Cn.PageRender=[],Cn.MetaRender=[],Ln[pn]={},Ln[fn]={},Ln[mn]={},Ln[hn]={},Ln[vn]={},Ln[_n]={},Ln[ln]={},e.register=h,e.unregister=y;var Fn={},On,$n,Nn,zn,Pn=window,Zn={},Rn;e.set=P;var Mn,qn;e.get=ne;var Dn=1e4,Hn=[],In=[],Kn=!1,Un=0,Bn=0,Qn=!1,Jn={},Gn=[],Vn=!1;h(sn,Ke);var Xn,Wn,Yn,er;history.pushState({path:location.pathname+location.search},"",location.pathname+location.search),window.onpopstate=function(e){e.state&&e.state.path&&(er=e.state,kt())};var tr=new MutationObserver(function(e){nt(e)}),nr,rr,ar="donut-percentage",ir=["percentage","color","height","width","labels"],or=/\['[a-zA-Z0-9_]+','[a-zA-Z0-9_]+'\]/,ur=/from_percentage\((\[0x[0-9a-fA-F][0-9a-fA-F],0x[0-9a-fA-F][0-9a-fA-F],0x[0-9a-fA-F][0-9a-fA-F]\]);(\[0x[0-9a-fA-F][0-9a-fA-F],0x[0-9a-fA-F][0-9a-fA-F],0x[0-9a-fA-F][0-9a-fA-F]\])\)/,cr={Django:[["ajax.beforeSend",ft]],DjangoRestFramework:[["models.listOutput",dt]],Finre:[["forms.setup",ht]],Chartjs:[["chart.render",_t],["chart.config",vt]]};e.models={},e.models.NameResolutionDefault={m2p:function(e){return e.replace(/^([A-Z])/,function(e){return e.toLowerCase()}).replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})+"s"},p2m:function(e){return e.replace(/^([a-z])/,function(e){return e.toUpperCase()}).replace(/(-[a-z])/g,function(e){return e.charAt(1).toUpperCase()}).replace(/s$/,"")},m2i:function(e){return e.replace(/^([A-Z])/,function(e){return e.toLowerCase()}).replace(/([A-Z])/g,function(e){return"_"+e.toLowerCase()})},i2m:function(e){return e.replace(/^([a-z])/,function(e){return e.toUpperCase()}).replace(/(_[a-z])/g,function(e){return e.charAt(1).toUpperCase()})},m2l:function(e){return this.m2i(e)+"s"},l2m:function(e){return this.i2m(e).replace(/s$/,"")}};var sr=document.querySelector("[setu-app]"),lr,fr;if(!sr)throw new TypeError(__badly_configured_msg__);e.run=bt,e.refresh=Et,e.open=At,e.clear=function(){Le()},e.app=sr}(window.Setu=window.Setu||{});
