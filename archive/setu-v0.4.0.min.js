!function(T,i){function s(e){return"[object Array]"===Object.prototype.toString.call(e)}function u(e){return"object"==typeof e&&!s(e)}function a(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()}function n(){}function t(e){for(e in mu[e]&&(vu=mu[e]),mu)mu[e]<=vu?console[e]=console[e]||n:console[e]=n;hu=r("time","error"),Au=r("timeEnd","error"),console.time=r("time","error"),console.timeEnd=r("timeEnd","error"),yu=console.info,Tu=console.warn,gu=console.error}function r(e,t){return console[e]&&n!==console[t]?console[e]:n}function o(e,t,n){Nu[e]=Nu[e]||[],Nu[e].push([n,t])}function c(e){if(!Nu[e])return[];var t=Array.prototype.slice.apply(arguments),n=[];return Nu[e].forEach(function(e){t[0]=e[0],n.push(e[1].apply(null,t))}),n}function f(e,t,n){Su[e].contains(n)||(Su[e].push(n),Su[e].push(t))}function l(e,t,n,r){wu[e][t]=wu[e][t]||[],wu[e][t].contains(r)||(wu[e][t].push(r),wu[e][t].push(n))}function g(e,t,n){for(var r=Su[e].slice(),o=0;o<r.length;o+=2)try{r[o+1](r[o],t,n)}catch(e){}}function p(e,t,n,r){var o=wu[e][t];if(o){o=o.slice();for(var a=0;a<o.length;a+=2)try{o[a+1](o[a],n,r)}catch(e){}}}function E(e,t){Su[e].remove(t,2)}function d(e,t,n){var r=wu[e][t];r&&r.remove(n,2)}function _(){for(var e in bu)delete bu[e];bu={},Ru=i}function m(e,t){bu[e]=t}function v(e){var t={};for(var n in e)if(e.hasOwnProperty(n)&&(!bu.hasOwnProperty(n)||bu[n]!==e[n])){var r=e[n];m(n,r),t[n]=r}return t}function h(){for(var e in Ru=$u.event,bu)$u[e]=bu[e]}function A(){for(var e in bu)$u.hasOwnProperty(e)&&delete $u[e];$u.event=Ru}function y(e){for(var t in e)e.hasOwnProperty(t)&&delete bu[t]}function N(e,t){var n=v(e);h();var r=t.replace(Ei,function(e){return S(e)});return r=r.replace(di,function(e){return S(e,!0)}),A(),y(n),r}function S(t,e){var n;n=(n=e?t.replace(/^{!{/,"").replace(/}!}$/,""):t.replace(/^{{/,"").replace(/}}$/,"")).replace(/\s*\|\s*/,"|").trim(),parts=n.split("|");try{var r=w(parts);return e?r||t:i!==r?r:t}catch(e){return t}}function w(e){var t=eval(e[0]);if(i===t)return i;for(var n=1;n<e.length;++n){var r=e[n];if(!b(r))return i;if(t=R(r,t),i===t)return i}return t}function $(e,t){var n=v(e),r;h();try{r=Dr(t)?eval(N({},t)):eval(t)}catch(e){r=t}return A(),y(n),r}function e(e){return new Date(e).toISOString()}function b(e){return e in ku}function R(e,t){return ku[e](t)}function k(e,t){return e.pathname===t.pathname&&e.search===t.search}function C(e){var t=e.match(/#/)?e.replace(/^.*#/g,"#"):"",n=t?e.replace(/#.*$/g,""):e,r=n.match(/\?/)?n.replace(/^.*\?/g,"?"):"";return{pathname:r?n.replace(/\?.*$/g,""):n,search:r,fragment:t}}function O(e){L(window.location.pathname+window.location.search+"#"+e,{pathname:window.location.pathname,search:window.location.search,fragment:"#"+e})}function L(e,t){t=t||C(e),window.history.pushState(t,"",e),D()}function V(e){var t=C(e);window.history.replaceState(t,"",e),D()}function P(){return Cu&&Cu.pathname?Cu.pathname:null}function I(){Cu=null}function D(){GLastUrl={pathname:window.location.pathname,search:window.location.search,fragment:window.location.hash}}function U(){Lu={}}function M(e,t,n,r,o){(n=n||{}).method=e||Ca,n.cache=n.cache||!1,n.beforeSend=n.beforeSend||function(e,t){G(),c(T.ADAPTER_AJAX_BEFORE_SEND,e,t,this)},j(n,t,e,r),x(n,t,e,o),$_.ajax(t,n)}function j(e,a,i,u){e.success=function(t,n,r,o){H();try{c(T.ADAPTER_AJAX_ON_RESPONSE,t,n,r,o)}catch(e){}try{"function"==typeof u&&u({data:t,status:n,xhr:o,url:r}),Ca===i&&a in Lu&&(Lu[a].forEach(function(e){"function"==typeof e.onsuccess&&e.onsuccess({data:t,status:n,xhr:o,url:r})}),delete Lu[a])}catch(e){gu("Setu.http ! error onsuccess",e.message,e.stack),Ca===i&&delete Lu[a]}}}function x(e,a,i,u){e.error=function(e,t,n,r){gu("Setu.http ajax !",n,i,t,e),H();try{c(T.ADAPTER_AJAX_ON_RESPONSE,e,t,n,r)}catch(e){}var o=JSON.stringify({status:t,error:e,url:n});try{"function"==typeof u&&u(Error(o)),Ca===i&&a in Lu&&(Lu[a].forEach(function(e){"function"==typeof e.onerror&&e.onerror(Error(o))}),delete Lu[a])}catch(e){gu("Setu.http ! error onerror",e.message,e.stack),Ca===i&&delete Lu[a]}("number"!=typeof t||t<400)&&g(T.EVENT_AJAX_ERROR,null,{status:t,error:e})}}function G(){if("function"==typeof T.appAjaxStart)try{T.appAjaxStart()}catch(e){}}function H(){if("function"==typeof T.appAjaxEnd)try{T.appAjaxEnd()}catch(e){}}function q(e,t,n,r){Lu[e]?Lu[e].push({onsuccess:n,onerror:r}):(Lu[e]=[],M(Ca,e,t,n,r))}function z(e,t,n,r){M(Oa,e,t,n,r)}function Z(e,t,n,r){M(La,e,t,n,r)}function F(e,t,n,r){M(Va,e,t,n,r)}function J(e,t,n,r){M(Pa,e,t,n,r)}function B(e){e&&document.body.contains(e)&&Pu.observe(e,{childList:!0,subtree:!0})}function K(){Pu.disconnect()}function X(e){Vu=!1,e.forEach(function(e){e.addedNodes&&e.addedNodes.forEach(function(e){ba===e.nodeType&&document.body.contains(e)&&Lr(e)&&(Vu=!0,to(e))})}),Y()&&(Xr()&&Yr(),Vu=!1)}function Y(){return Vu}function W(e){Iu=e,ee()}function Q(e){var t;ne(),(t=te(Uu))?re(t,e):e()}function ee(){Du=Uu=i}function te(e){if(Iu[e])return Iu[e];for(var t in Iu)if(e.match(new RegExp(t)))return Iu[t];return!1}function ne(){var e=P();e?(Uu=e,I()):Uu=location.pathname.replace(/\/$/,"")}function re(e,t){"function"==typeof e?e(function(e){oe(e,t)}):oe(e,t)}function oe(e,t){Du=e,t()}function ae(){return Du}function ie(){return Du.redirect}function ue(){return Du.redirect}function ce(){return Du.include}function fe(){return Du.include}function se(){return Du.flush}function le(){return Du.require}function pe(e){(Mu=e).logLevel&&t(Mu.logLevel),Mu.adapters&&Mu.adapters.forEach(function(e){T.adapters[e].forEach(function(e){o(e.purpose,e.handler)})})}function Ee(){return Mu.pathchange&&Mu.pathchange.flush?Mu.pathchange.flush:i}function de(e){for(var t in e)if(e.hasOwnProperty(t)){var n=_e(e,t);Ze(t,Le(n,t,Ce(t,n),Oe(t,n)))}}function _e(e,t){var n=me(e,t);for(var r in ve(t,n),n)n.hasOwnProperty(r)&&he(e,t,n,r);return n}function me(e,t){var n=e[t];if(!u(n))throw gu("Setu.mparse !",t,"model definition must be an object",n),new TypeError(fu);return n}function ve(t,n){Ia.forEach(function(e){if(e in n)throw gu("Setu.mparse !",e,"is used as a field in model",t,"but it is reserved"),new TypeError(fu)})}function he(e,t,n,r){var o=Ae(t,n,r);switch(ye(t,r,o)){case ci:Te(t,r,o,ti);break;case ui:ge(t,r,o);break;case ii:Ne(e,t,r,o);break;case ai:Se(e,t,r,o)}}function Ae(e,t,n){var r=t[n];if(!u(r))throw gu("Setu.mparse !",e,"model field",n,"definition is not an object",r),new TypeError(fu);return r}function ye(e,t,n){return we(e,t,n),za in n?ai!==n.type?qa in n?ui:ci:ai:ii}function Te(e,t,n,r){be(e,t,n,ei),Re(e,t,n,r)}function ge(e,t,n){Te(e,t,n,ni)}function Ne(e,t,n,r){$e(e,t,n,r),Re(t,n,r,Qa)}function Se(e,t,n,r){switch(Re(t,n,r,ri),ke(t,n,r.elements)){case ci:Te(t,n,r.elements,oi);break;case ii:Ne(e,t,n,r.elements)}}function we(e,t,n){if(za in n&&Ma in n)throw gu("Setu.mparse !",'both "type" and "fk" are defined in',n,"in model",e,"field",t),new TypeError(fu);if(!(za in n||Ma in n))throw gu("Setu.mparse !",'none of "type" and "fk" are defined in',n,"in model",e,"field",t),new TypeError(fu)}function $e(e,t,n,r){if(!(r.fk in e))throw gu("Setu.mparse !","model",r.fk,"referred to in",r,"as a foreign key field",n,"in model",t,"does not exist"),new TypeError(fu)}function be(e,t,n,r){if(!r.contains(n.type))throw gu("Setu.mparse !","unsupported type",n.type,"in",n,"in model",e,"field",t,"allowed ones are:",r),new TypeError(fu)}function Re(e,t,n,r){for(var o in n)if(n.hasOwnProperty(o)&&!r.contains(o))throw gu("Setu.mparse !","unsupported parameter",o,"in",n,"in model",e,"field",t,"allowed ones are:",r),new TypeError(fu)}function ke(e,t,n){return we(e,t,n),n.type?ci:ii}function Ce(e,t){var n=[];for(var r in t)t.hasOwnProperty(r)&&t[r].pk&&n.push(r);if(!n.length)throw gu("Setu.mparse !","model",e,"does not have any primary keys defined"),new TypeError(fu);return n}function Oe(e,t){var n={};for(var r in t)t.hasOwnProperty(r)&&t[r].fk&&(n[r]=t[r].fk);return n}function Le(e,t,n,r){var o={};return o.name=t,o.prefix=Me()+"/"+je(o.name),o.def=e,o.pks=n,o.fks=r,o.iType=Ve(o),o}function Ve(e){var t={};for(var n in e.def)e.def.hasOwnProperty(n)&&(t[n]={get:et(n),set:tt(n),enumerable:!0});return t.__model__={value:e.name,writable:!1,enumerable:!1,configurable:!1},t}function Pe(e,t){xu=t||{trailingSlash:!0,nameResolution:"Setu.models.NameResolutionDefault",urlPrefix:"",compositePkToUrl:T.MULTI_PK_TO_URL_KEY_VALUE_PATH,compositePkSeparator:"_",validateInstances:!0},xu.updateLists=xu.updateLists||{updateLists:{fields:{},filters:{},instanceFks:{}}},xu.updateLists.fields=xu.updateLists.fields||{},xu.updateLists.filters=xu.updateLists.filters||{},xu.updateLists.instanceFks=xu.updateLists.instanceFks||{},ju=e||{},Gu=eval(xu.nameResolution)}function Ie(e,t){var n=ju[e.__model__];return n&&"function"==typeof n[t]?n[t](e):i}function De(e,t,n){var r=xu.updateLists[e][t];return r&&n&&(r=r[n.__model__]),r}function Ue(){return xu.trailingSlash?"/":""}function Me(){return xu.urlPrefix}function je(e){return Gu.m2p(e)}function xe(e){return Gu.m2i(e)}function Ge(e){return Gu.m2l(e)}function He(){return xu.compositePkToUrl}function qe(){return xu.compositePkSeparator}function ze(e,t,n){Pe(t,n),de(e)}function Ze(e,t){Hu[e]=t}function Fe(e){if(!Hu[e])throw gu("Setu.models ! model",e,"not defined by application"),new TypeError(fu);return Hu[e]}function Je(e){return Hu[e]}function Be(e){var t=at();e.iType.__meta_idx__={value:t,writable:!0,enumerable:!1,configurable:!1};var n=Object.create(Object.prototype,e.iType);return delete e.iType.__meta_idx__,$t(n),n}function Ke(e,t){return e.prefix+Ue()+(t?"?"+t:"")}function Xe(e,t,n,r){return e.prefix+"/"+Ye(t,n)+Ue()+(r?"?"+r:"")}function Ye(e,t){return Si===t?e:We(e)}function We(e){switch(He()){case T.MULTI_PK_TO_URL_KEY_VALUE_PATH:return e.replace(/,/,"/");case T.MULTI_PK_TO_URL_ORDERED_VALUES_PATH:return Qe(e,"/");case T.MULTI_PK_TO_URL_ORDERED_SEPERATED_VALUES:return Qe(e,qe()||"_")}}function Qe(e,t){var n=e.split(","),r=[];return n.forEach(function(e){r.push(e.replace(/^[^=]+=/,""))}),r.join(t)}function et(e){return function(){return qu[ut(this).$i[e]]}}function tt(o){return function(e){var t=ut(this),n=t.$i[o],r=qu[n];if(r!==e){if(!t.$d||t.$s)return void(qu[n]=e);t.$c[o]={oldVal:r,newVal:e}}else delete t.$c[o]}}function nt(e){return qu[zu]=e,zu++}function rt(){return Object.keys(qu).length}function ot(e){delete qu[e]}function at(){return Fu++}function it(e){var t=Zu[e.__meta_idx__]={};return t.$m=Fe(e.__model__),t.$i={},t.$c={},t}function ut(e){return Zu[e.__meta_idx__]}function ct(){return Object.keys(Zu).length}function ft(e,t,n){delete Zu[e.__meta_idx__],e.__meta_idx__=n,t.$k=n,Zu[n]=t}function st(e){delete Zu[e.__meta_idx__]}function lt(){for(var e in Zu);}function pt(e,t,n,r){for(var o in t)if(Et(t[o],r)&&!(o in n))throw gu("Setu.iparse ! instance data",n,"for model",e,"does not have required field",o),new TypeError(su)}function Et(e,t){return e.pk&&!t&&!e.auto||e.fk||!e.optional}function dt(e,t,n,r){for(var o in n)o in t&&(_t(e,o,t[o],n),r[o]=n[o])}function _t(e,t,n,r){switch(ye(e,t,n)){case ci:mt(e,t,n,r);break;case ui:vt(e,t,n,r);break;case ii:ht(e,t,n,r);break;case ai:yt(e,t,n,r)}}function mt(e,t,n,r){var o=n.type,a=r[t];if(St(a,n))throw gu("Setu.iparse !",e,"model field",t,"is null in",r,"which is not allowed"),new TypeError(su);if(null!==a&&!wt(a,o))throw gu("Setu.iparse !",e,"model field",t,"is",a,"in",r,"which is not of required type:",o),new TypeError(su)}function vt(e,t,n,r){mt(e,t,n,r)}function ht(e,t,n,r){var o=Fe(n.fk);if(u(r[t])){dt(o.name,o.def,r[t],{})}else{var a=o.pks[0];At(o.name,a,o.def[a],e,t,n,r)}}function At(e,t,n,r,o,a,i){var u=n.type,c=i[o];if(St(c,a))throw gu("Setu.iparse !",r,"model field",o,"is a foreign key to",e,"and is null in",i,"which is not allowed"),new TypeError(su);if(null!==c&&!wt(c,u))throw gu("Setu.iparse !",r,"model field",o,"is a foreign key to",e,"whose primary key",t,"is of type",u,"but the value is",c,"in",i),new TypeError(su)}function yt(e,t,n,r){if(!s(r[t]))throw gu("Setu.iparse !",e,"model field",t,"must be an array but the value is",r[t],"in",r),new TypeError(su);switch(ke(e,t,n.elements)){case ci:Tt(e,t,n.elements,r);break;case ii:gt(e,t,n.elements,r)}}function Tt(t,n,r,o){var a=r.type;o[n].forEach(function(e){if(St(e,r))gu("Setu.iparse !",t,"model array field",n,"contains a null element in",o,"which is not allowed");else if(null!==e&&!wt(e,a))throw gu("Setu.iparse !",t,"model array field",n,"has",e,"in",o,"which is not of required type:",a),new TypeError(su)})}function gt(r,e,o,a){a[e].forEach(function(e){var t=Fe(o.fk);if(u(e)){dt(t.name,t.def,e,{})}else{var n=t.pks[0];Nt(t.name,n,t.def[n],r,e,o,a)}})}function Nt(e,t,n,r,o,a,i){var u=n.type;if(St(o,a))throw gu("Setu.iparse !",r,"model field",field,"contains foreign keys to",e,"and cannot have nulls","but nulls are there in",i),new TypeError(su);if(null!==o&&!wt(o,u))throw gu("Setu.iparse !",r,"model field",field,"contains foreign keys to",e,"whose primary key",t,"is of type",u,"but value of an array element",o,"in",i,"does not match the type"),new TypeError(su)}function St(e,t){return null===e&&!t.null}function wt(e,t){switch(t){case Za:case Xa:return t===typeof e;case Ka:return"number"==typeof e&&!e.toString().match(/\./);case Ba:return"number"==typeof e;case Ja:return"string"==typeof e&&e.match(Ti);case Fa:return"string"==typeof e&&e.match(gi);case Ya:return"string"==typeof e&&e.match(Ni);case Wa:return"string"==typeof e&&e.match(yi)}return!1}function $t(e){var t=it(e),n=t.$m;for(var r in n.def){var o="array"!==n.def[r].type?i:[];t.$i[r]=nt(o)}}function bt(e){var t=Fe(e.__model__),n=ut(e);for(var r in t.def){ot(n.$i[r])}st(e)}function Rt(e,t){if(t){var n=e.__model__;model=Fe(n),modelDef=model.def,imeta=ut(e),pt(n,modelDef,t,imeta.$d),dt(n,modelDef,t,e),imeta.$d=!0,ft(e,imeta,n+":"+kt(e)),wn(e,imeta)}}function kt(t){var e=Fe(t.__model__);if(1===e.pks.length)return t[e.pks[0]];var n=[];return e.pks.forEach(function(e){n.push(e+"="+t[e])}),n.join(";")}function Ct(e){var t=e.split(";"),n={};return t.forEach(function(e){var t=e.split("=");n[t[0]]=t[1]}),n}function Ot(e,t,n){return!t.$d||(gu("Setu.instances","internal programming error or user-forced recreation of an already created instance",e),n(e),!1)}function Lt(e,t){var n={},r=t.$m.def;for(var o in r)r.hasOwnProperty(o)&&!r[o].auto&&(n[o]=e[o]);return n}function Vt(e,t,n){return!!t.$d||(gu("Setu.instances","internal programming error or user forced update of an instance that does not exist in backend",e),n(e),!1)}function Pt(e,t){var n={};for(var r in t.$c)t.$c.hasOwnProperty(r)&&(n[r]=t.$c[r].newVal);return Object.keys(n).length?n:null}function It(e,t){var n=t.$m.prefix+Ue();return t.$qp&&(n+="?"+t.$qp,delete t.$qp),n}function Dt(e,t){var n=t.$m,r=1===n.pks.length?Si:wi,o=Xe(n,Ut(n,r,e),r,t.$qp);return t.$qp&&delete t.$qp,o}function Ut(e,t,n){return Si===t?n[e.pks[0]]:Mt(e.pks,n)}function Mt(e,t){var n=[];return e.forEach(function(e){n.push(e+"="+t[e])}),n.join(",")}function jt(e){Nn(ut(e).$k),bt(e)}function xt(e){var t={},n=imeta.$m.def;for(var r in n)n.hasOwnProperty(r)&&(t[r]=e[r]);return t}function Gt(t,e,n,r){q(Ke(t,e=e||""),{format:"json"},function(e){Ht(t,e,n)},function(e){"function"==typeof r&&r([])})}function Ht(n,e,t){var r=c(T.ADAPTER_MODELS_LIST,e)[0],o=[];r.list.forEach(function(e){var t=Be(n);Rt(t,e),o.push(t)}),t(o,r.page,r.last,r.count)}function qt(t,e,n,r,o,a){q(Xe(t,e,n,r),{format:"json"},function(e){zt(t,e,o)},function(e){"function"==typeof a&&a({})})}function zt(e,t,n){var r=t.data,o=Be(e);Rt(o,r),n(o)}function Zt(e,t,n,r){q(e+(t?"?"+t:""),{format:"json"},function(e){n(e.data)},function(e){"function"==typeof r&&r({})})}function Ft(e,t,n){var r=ut(e);return r.$d?Bt(e,r,t,n):Jt(e,r,t,n)}function Jt(n,e,r,t){Ot(n,e,r)&&z(It(n,e),{data:Lt(n,e),contentType:$a,format:"json"},function(e){Rt(n,e.data);var t=xt(n);p(T.EVENT_INSTANCE_CREATE,n.__model__,n),r(t)},function(e){"function"==typeof t&&t(JSON.parse(e.message))})}function Bt(n,r,o,t){if(Vt(n,r,o)){var e=Pt(n,r);e&&Z(Dt(n,r),{data:e,contentType:$a,format:"json"},function(e){var t=Kt(n,r,e);o(t)},function(e){"function"==typeof t&&t(JSON.parse(e.message))})}}function Kt(e,t,n){var r=n.data,o=t.$m.def,a=e.__model__;t.$s=!0,dt(a,o,r,e),t.$s=!1;var i=xt(e);return p(T.EVENT_INSTANCE_CHANGE,t.$k,e,t.$c),p(T.EVENT_INSTANCE_CHANGE,e.__model__,e,t.$c),t.$c={},i}function Xt(t,n,r){var o=ut(t);J(Dt(t,o),{format:"json"},function(e){p(T.EVENT_INSTANCE_DELETE,o.$k,t),p(T.EVENT_INSTANCE_DELETE,t.__model__,t),jt(t),"function"==typeof n&&n(r)},function(e){})}function Yt(e){Bu=e,Ju={}}function Wt(e){if(!e||!e.length)return!1;var r={};return e.every(function(e){var t,n=e.title;return(t=Ju[e.key])&&t.value?(r[n]=t.value,!0):r=!1}),r}function Qt(n,r,o){if(n&&n.length){var a={};n.forEach(function(e){var t="string"==typeof e?en(r,e):e;En(t=pn(t),function(e){a[e.title]=e.value,Object.keys(a).length===n.length&&o(a)})})}else o({})}function en(e,t){var n=Bu[t];return n?tn(t,n):nn(e,t)}function tn(e,t){return{type:Bi,key:e,title:e,api:t}}function nn(e,t){var n={},r=t,o=on(t=rn(t,e),r);n.key=an(o);var a=Je(o[3]),i=Bu[o[3]];if(!a&&!i)throw gu("Setu.resources ! invalid resource key",r,t),new TypeError(fu);return un(o,n),a?(n.model=a,sn(o,n),n.title=o[2]||ln(n)):(n.api=i,n.title=o[2]||n.key,n.type=Bi),n}function rn(e,t){if(Dr(e))try{e=N(t,e)}catch(e){}return e}function on(e,t){var n=e.match(pi);if(!n||12!==n.length)throw gu("Setu.resources !","invalid key",t),new TypeError(lu);return n}function an(e){return e[3]+(e[5]?":"+e[5]:"")+(e[10]?"|"+e[10]:"")}function un(e,t){e[10]&&(t.params=fn(e[10]),t.queryparams=e[10].replace(/;/g,"&"))}function cn(e){if(e.params){var t=[];for(var n in e.params)t.push(n+"="+e.params[n]);e.queryparams=t.join("&")}}function fn(e){var t=e.split(";"),n={};return t.forEach(function(e){var t=e.match(/^([^=]+)=(.*)$/);n[t[1]]=t[2]}),n}function sn(e,t){e[5]?(t.pk=e[5],t.pkType=e[5].match(/,/)?wi:Si,t.type=Xi):t.type=Ki}function ln(e){return Xi===e.type?xe(e.model.name):Ge(e.model.name)}function pn(e){if(Ju[e.key]){var t=e.title;t!=(e=Ju[e.key]).title&&(e.title=t)}else Ju[e.key]=e;return e}function En(e,t){switch(e.type){case Ki:dn(e,t);break;case Xi:mn(e,t);break;case Bi:vn(e,t)}}function dn(a,i,e){if(a.value&&!e)i(gn(a));else{if(hn(a))return void yn(a,i);An(a),Gt(a.model,a.queryparams,function(e,t,n,r){a.value=a.value||[],e.forEach(function(e){a.value.push(e)}),a.page=t||1,a.last=n,a.count=r,Rn(a);var o=gn(a);i(o),Tn(a,o)},function(e){var t={title:a.title,value:e};i(t),Tn(a,t)})}}function _n(e,t){for(;e.value.length;)jt(e.value.pop());dn(e,t,!0)}function mn(n,r){if(n.value)r(gn(n));else{if(hn(n))return void yn(n,r);An(n),qt(n.model,n.pk,n.pkType,n.queryparams,function(e){n.value=e,Yn(n);var t=gn(n);r(t),Tn(n,t)},function(e){var t={title:n.title,value:e};r(t),Tn(n,t)})}}function vn(n,r){n.value?r(gn(n)):Zt(n.api,n.queryparams,function(e){n.value=e;var t=gn(n);r(t)},function(e){r({title:n.title,value:e})})}function hn(e){return e.key in Ku}function An(e){Ku[e.key]=[]}function yn(e,t){Ku[e.key].push(t)}function Tn(e,t){if(e.key in Ku){var n=Ku[e.key].slice();delete Ku[e.key],n.forEach(function(e){e(t)})}}function gn(e){return{title:e.title,value:e.value}}function Nn(e){e in Ju&&($n(Ju[e]),delete Ju[e])}function Sn(){for(var e in Ju)Ju.hasOwnProperty(e)&&Nn(e)}function wn(e,t){if(!(t.$k in Ju)){var n={key:t.$k,model:t.$m,pk:kt(e),pkType:1===t.$m.pks.length?Si:wi,title:xe(e.__model__),type:Xi,value:e};Yn(n),Ju[t.$k]=n}}function $n(e){Ki===e.type?kn(e):Xi===e.type&&Wn(e)}function bn(e){return Ju[e]}function Rn(e){if(!e.registered){l(T.EVENT_INSTANCE_CREATE,e.model.name,Cn,e),l(T.EVENT_INSTANCE_CHANGE,e.model.name,On,e),l(T.EVENT_INSTANCE_DELETE,e.model.name,Ln,e);var t={};if(e.params)for(var n in t=qn(e)){var r=t[n];l(T.EVENT_INSTANCE_CHANGE,r,Vn,e),l(T.EVENT_INSTANCE_DELETE,r,Pn,e)}for(var n in e.model.fks)if(!(n in t)){r=e.model.fks[n];l(T.EVENT_INSTANCE_CREATE,r,In,e),l(T.EVENT_INSTANCE_CHANGE,r,Dn,e),l(T.EVENT_INSTANCE_DELETE,r,Un,e)}e.registered=!0}}function kn(e){if(e.registered){d(T.EVENT_INSTANCE_CREATE,e.model.name,e),d(T.EVENT_INSTANCE_CHANGE,e.model.name,e),d(T.EVENT_INSTANCE_DELETE,e.model.name,e);var t={};if(e.params)for(var n in t=qn(e)){var r=t[n];d(T.EVENT_INSTANCE_CHANGE,r,e),d(T.EVENT_INSTANCE_DELETE,r,e)}for(var n in e.model.fks)if(!(n in t)){r=e.model.fks[n];d(T.EVENT_INSTANCE_CREATE,r,e),d(T.EVENT_INSTANCE_CHANGE,r,e),d(T.EVENT_INSTANCE_DELETE,r,e)}e.registered=!1}}function Cn(e,t){Mn(e,t)&&Jn(e,t)}function On(e,t,n){var r=Mn(e,t),o=e.value.contains(t);if(!r&&o)Bn(e,t);else if(r&&!o)Jn(e,t);else if(o){var a=De(fi,e.model.name);a&&Kn(e,a,n)}}function Ln(e,t){e.value.contains(t)&&Bn(e,t)}function Vn(e,t,n){var r=De(si,e.model.name,t);!r||e.value.length&&!zn(e,t)||Kn(e,r,n)}function Pn(e,t){e.value.length&&!zn(e,t)||(p(T.EVENT_LIST_RESOURCE_DELETE,e.key,e),Nn(e))}function In(e,t){var n=De(li,e.model.name,t);n&&Fn(n)&&Xn(e,!0)}function Dn(e,t,n){var r=De(li,e.model.name,t);r&&(!e.value.length||Zn(e,t)||Fn(r))&&Kn(e,r,n)}function Un(e,t){if(e.value.length&&!Zn(e,t)){var n=De(li,e.model.name,t);n&&Fn(n)&&Xn(e,!0)}else Xn(e,!0)}function Mn(e,t){if(e.params)for(var n in e.params){if(n in t)return jn(e,t,n);if(!Hn(e.params[n],Ie(t,n)))return!1}return!0}function jn(e,t,n){return u(t[n])?xn(e,t,n):!!Hn(e.params[n],t[n])}function xn(e,t,n){var r=ut(t).$m.def[n].fk;return r?Gn(e,t,n,Fe(r)):(gu("Setu.lists !ϵ - field in instance is an object however it was not defined as a foreign key",t,n,e),!1)}function Gn(e,t,n,r){if(1===r.pks.length){if(!Hn(e.params[n],t[n]&&t[n][r.pks[0]]))return!1}else{var o=Ct(e.params[n]);for(var a in o)if(!Hn(o[a],t[n]&&t[n][a]))return!1}return!0}function Hn(e,t){try{return"string"!=typeof t?eval(e)===t:e===t}catch(e){return!1}}function qn(e){var t={};for(var n in e.params)n in e.model.fks&&(t[n]=e.model.fks[n]);return t}function zn(e,t){var n=!1,r=e.model.def;for(var o in e.params)if(r[o]&&r[o].fk===t.__model__&&kt(t).toString()===e.params[o]){n=!0;break}return n}function Zn(e,t){var n,r=t.__model__;for(var o in e.model.fks)if(r===e.model.fks[o]){n=o;break}if(!n)return!1;for(var a=0;a<e.value.length;++a){var i=e.value[a];if(i[n]===kt(t))return!0}return!1}function Fn(e){return"always"===e.__trigger__}function Jn(e,t){e.value.unshift(t),1<e.value.length?Xn(e):g(T.EVENT_LIST_RESOURCE_CREATE,e)}function Bn(e,t){e.value.remove(t),Xn(e)}function Kn(e,t,n){var r=!1;if(!0===t)r=!0;else for(var o in n)if(o in t){r=!0;break}r&&Xn(e,!0)}function Xn(t,e){if(e){var n=t.key.match(pi),r=Setu.pageSizeParam||Setu.PAGE_SIZE_PARAM,o=t.params[r];un(n,t),o&&(t.params[r]=o),cn(t)}_n(t,function(e){Ao(t),p(T.EVENT_LIST_RESOURCE_CHANGE,t.key,t)})}function Yn(e){if(!e.registered){var t=ut(e.value).$k;l(T.EVENT_INSTANCE_CHANGE,t,Qn,e),l(T.EVENT_INSTANCE_DELETE,t,er,e),e.registered=!0}}function Wn(e){if(e.registered){var t=ut(e.value).$k;d(T.EVENT_INSTANCE_CHANGE,t,e),d(T.EVENT_INSTANCE_DELETE,t,e),e.registered=!1}}function Qn(e,t,n){p(T.EVENT_DETAIL_RESOURCE_CHANGE,e.key,e,n)}function er(e){p(T.EVENT_DETAIL_RESOURCE_DELETE,e.key,e),Nn(e.key)}function tr(e){return Da in e||(++Yu,e[Da]=Yu,Xu[e[Da]]={}),nr(e)}function nr(e){return Xu[e[Da]]}function rr(e){or(e)&&(delete Xu[e[Da]],delete e[Da])}function or(e){return Da in e}function ar(e){var t=tr(e);if(lr(t),!Object.keys(t.$p.$n).length)for(var n=e.parentNode;n&&!Na(n);){var r=nr(n);if(r&&r.$p&&r.$p.$n)return void pr(r,t);n=n.parentNode}return t}function ir(e,t,n,r){ur(e,t);var o=nr(t);o.$p.$c={},o.$p.$c[n]=r,o.$p.$n[n]=r,o.$p.$l=!0}function ur(e,t){var n=tr(t),r=nr(e);lr(n),pr(r,n),Er(r,n)}function cr(e,t,n){if(t.$p.$o){var r=t.$p.$o,o=nr(r),a=nr(n);o.$p.$i.remove(e),o.$p.$i.push(n),a.$p.$o=r}}function fr(e,t){var n=t.$p.$o;n&&nr(n).$p.$i.remove(e);delete t.$p.$o}function sr(e){for(;e&&!Na(e);){var t=nr(e);if(t.$p&&t.$p.$c)for(var n in t.$p.$c)return t.$p.$c[n];if("form"===e.tagName.toLowerCase()&&e.hasAttribute(Pi)){var r=bn(e.getAttribute(Pi));if(r)return r.value}e=e.parentNode}return null}function lr(e){e.$p=e.$p||{},e.$p.$n=e.$p.$n||{}}function pr(e,t){for(var n in e.$p.$n)t.$p.$n[n]=e.$p.$n[n]}function Er(e,t){var n=e.$p.$n;for(var r in delete e.$p.$n,e.$p)t.$p[r]=e.$p[r];e.$p.$n=n}function dr(){Wu={},Qu=0}function _r(e){var t=Qu++;return Wu[t]=e,t}function mr(e){return Wu[e]}function vr(e){delete Wu[e]}function hr(e,t){var n=Or(e);n.innerHTML=t;for(var r=Array.prototype.slice.call(n.childNodes);n.childNodes.length;)e.parentNode.insertBefore(n.childNodes[0],e);return yr(e),r}function Ar(e){var t=nr(e);if(!t||!t.$p)throw gu("Setu.elements !","internal error while trying to eval binds",e),new Error(pu);var n=t.$p,r=$r(e,n.$t);e.parentNode.insertBefore(r.childNodes[0],e);var o=e.previousSibling;return ur(e,o),cr(e,t,o),n.$c&&(nr(o).$p.$c=n.$c),yr(e),o}function yr(e){rr(e),document.body.contains(e)&&e.parentNode.removeChild(e)}function Tr(e){var t=nr(e).$p,n=document.createComment(gr(e,t));return tr(n).$p=t,e.parentNode.insertBefore(n,e),yr(e),n}function gr(e,t){return Zi+":"+_r(t.$t||e.outerHTML)}function Nr(e){if(e&&document.body.contains(e)){var t=br(e),n=nr(e).$p;n.$i&&(n.$i.forEach(function(e){yr(e)}),delete n.$i);var r=tr(t);return r.$p=n,rr(e),e.parentNode.removeChild(e),t}}function Sr(e){return Cr(e,wr(e))}function wr(e){var t=nr(e);if(!t||!t.$p||!t.$p.$t)throw gu("Setu.elements ! template-to-node",e,t),new Error(pu);return t.$p.$t}function $r(e,t){var n=Or(e);return n.innerHTML=t,n}function br(e){var t=Rr(e),n=Cr(e,mr(t));return vr(t),e.parentNode.insertBefore(n,e),n}function Rr(e){return parseInt(e.textContent.replace(/^.*:/g,""),10)}function kr(e){return Cr(e,mr(Rr(e)))}function Cr(e,t){var n=Or(e);return n.innerHTML=t,n.firstChild}function Or(e){var t=e.parentNode.tagName.toLowerCase();return"body"===t&&(t="div"),document.createElement(t)}function Lr(e){return Ur(e)||Ir(e)||Vr(e)}function Vr(e){return 0!=Pr(e)}function Pr(e){return e.querySelectorAll(_u).length}function Ir(e){return Dr(e.outerHTML)}function Dr(e){return e.match(Ei)||e.match(di)}function Ur(e){for(var t=0;t<zi.length;++t)if(e.hasAttribute(zi[t]))return!0;return!1}function Mr(e){var t=e.getAttribute(Ri);return t?Qi===t?{type:t}:{type:nu,code:t}:null}function jr(e){if(e.hasAttribute(Di))return{type:eu,model:Fe(e.getAttribute(Di))};if(e.hasAttribute(Pi)){var t=e.getAttribute(Pi),n=en(nr(e).$p.$n,t);if(Xi!==n.type)throw gu("Setu.meta !","invalid instance resource key",t,e),new TypeError(lu);return{type:tu,resource:n}}return null}function xr(e){return Hr(e,bi)}function Gr(e){return Hr(e,Mi)}function Hr(e,t){if(!e.hasAttribute(t))return[];for(var n=e.getAttribute(t).split(","),r=0;r<n.length;++r){var o=en(nr(e).$p.$n,n[r]);if(!ec.contains(o.type))throw gu("Setu.meta !","invalid key",t,n[r],e),new TypeError(lu);n[r]=o}return n}function qr(e,t){if(e.hasAttribute(bi)){var n=new RegExp("[,]?"+zr(t)+"[,]?");return!!e.getAttribute(bi).match(n)}return!1}function zr(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Zr(){tc=[]}function Fr(e){tc.push(e)}function Jr(){return tc}function Br(e){tc=e}function Kr(){Zr(),dr(),nc=0,rc=!1}function Xr(){return 0===nc}function Yr(){ta(),aa(),g(T.EVENT_META_RENDER,T),rc||(rc=!0,g(T.EVENT_PAGE_RENDER,T))}function Wr(e){++nc}function Qr(e){--nc,eo()}function eo(){!Y()&&Xr()&&Yr()}function to(e,t){if(document.body.contains(e)){t||Wr(e),ar(e);var n=nr(e);switch(no(e,n.$p,n.$p.$n)){case iu:case au:return;case uu:case cu:break;case ou:_o(e,n)}Qr(e)}}function no(r,o,a){if(Ir(r)&&ro(r,a),r.hasAttribute(Vi)){var i=r.getAttribute(Vi).trim();if(!oc[i])return q(r.getAttribute(Vi).trim(),{},function(e){oc[i]=e.data;$_(r).index();var t=r.parentNode,n=oo(r,o,a,e.data);document.body.contains(r)?to(r,!0):(uo(t,n,a),Qr(r))},function(e){var t=JSON.parse(e.message);g(T.EVENT_AJAX_ERROR,null,{status:t.status,error:t.error})}),au;var e=$_(r).index(),t=r.parentNode,n=oo(r,o,a,oc[i]);if(!document.body.contains(r))return uo(t,n,a),cu}if(r.hasAttribute(Mi)){var u,c=Gr(r);if(!(u=Wt(c)))return co(r,o,a,c),au;for(var f in u)a[f]=u[f]}if(r.hasAttribute(bi)&&!o.$t&&!r.hasAttribute(Ii)){var s=r.getAttribute(bi);Dr(s)&&r.setAttribute(bi,N(a,s)),o.$t=r.outerHTML}if(r.hasAttribute(Ii)){if(null===(h=r.getAttribute(Ii).trim().match(mi)))return iu;f=h[1];var l,p=h[2];try{l=$(a,p)}catch(e){return gu("Setu.parser !",Ii,h[2],r,o,e.message,e.stack),iu}if(!l)return gu("Setu.parser !",Ii,h[2],r,o,l),iu;a[p]=l;var E=fo(r,o,f,l),d=Tr(r);return lo(d,E),Fr(d),E.slice().forEach(function(e){to(e)}),uu}if(r.hasAttribute(Li)){var _=r.getAttribute(Li).trim(),m=!1;try{m=$(a,_)}catch(e){return gu("Setu.parser !",Li,_,r,o,e.message,e.stack),iu}if(!m)return o.$l?(fr(r,nr(r)),yr(r)):(r.hasAttribute(bi)&&vo(r),Fr(Tr(r))),uu}if(r.hasAttribute(Oi)){var v=r.getAttribute(Oi).split(";");for(e=0;e<v.length;++e){if(null===(h=v[e].trim().match(vi)))return iu}for(e=0;e<v.length;++e){var h,A=(h=v[e].trim().match(vi))[1],y=h[2];try{y=$(a,y),a[A]=y}catch(e){return gu("Setu.parser !",Oi,A,h[2],r,o,e.message,e.stack),iu}}}Ir(r)&&(ro(r,a),Dr(r.innerHTML)&&Array.prototype.slice.call(r.childNodes).forEach(function(e){Ra===e.nodeType&&Dr(e.textContent)&&po(e,r,a)}));return Eo(r),ou}function ro(e,t){for(var n=0;n<e.attributes.length;++n){var r=e.attributes[n];Dr(r.value)&&(r.value=N(t,r.value))}}function oo(e,t,n,r){var o;return K(),e.hasAttribute(ji)?o=ao(e,t,n,r):io(e,t,n,r),B(cc),o}function ao(e,t,n,r){return hr(e,r)}function io(e,t,n,r){e.innerHTML=r,e.removeAttribute(Vi)}function uo(t,e,n){e.forEach(function(e){ba===e.nodeType?to(e):Ra===e.nodeType&&Dr(e.textContent)&&po(e,t,n)})}function co(n,e,r,t){Qt(t,{},function(e){for(var t in e)r[t]=e[t];to(n,!0)})}function fo(e,t,n,r){K();var o=so(e,r),a=r.length,i=$r(e,o),u=Array.prototype.slice.call(i.childNodes);for(idx=0;idx<a;++idx){var c=r[idx],f=i.childNodes[0];ir(e,f,n,c),e.parentNode.insertBefore(f,e)}return B(cc),u}function so(e,t){var n,r=e.getAttribute(Ii);e.removeAttribute(Ii);var o="",a=t.length;for(n=0;n<a;++n)o+=e.outerHTML;return e.setAttribute(Ii,r),o}function lo(t,e){(nr(t).$p.$i=e).forEach(function(e){nr(e).$p.$o=t})}function po(e,t,n){var r=N(n,e.textContent.trim()).trim(),o=document.createElement("div");for(o.innerHTML=r;o.childNodes.length;)t.insertBefore(o.childNodes[0],e);t.removeChild(e)}function Eo(e){Array.prototype.slice.call(e.childNodes).forEach(function(e){e.nodeType===ba&&Lr(e)&&to(e)})}function _o(e,t){if(e.hasAttribute(Ri)&&Qo(e,t),e.hasAttribute(Gi)?na(e):e.hasAttribute(Hi)?ra(e):e.hasAttribute(qi)&&oa(e),"form"===e.tagName.toLowerCase())Lo(e,t);else if("select"===e.tagName.toLowerCase())Io(e);else if("option"===e.tagName.toLowerCase()){for(var n=e.parentNode;n&&"select"!==n.tagName.toLowerCase();)n=n.parentNode;n&&!$_(e).next()&&Io(n)}e.hasAttribute(bi)&&vo(e,t)}function mo(){ac={}}function vo(e,t){ho(xr(e))}function ho(e){e.forEach(function(e){Ao(e)})}function Ao(e){var t=e.key;t in ac||(yo(t,e.type),ac[t]=!0)}function yo(e,t){Xi===t?(l(T.EVENT_DETAIL_RESOURCE_CHANGE,e,To,T),l(T.EVENT_DETAIL_RESOURCE_DELETE,e,go,T)):Ki===t&&(l(T.EVENT_LIST_RESOURCE_CHANGE,e,So,T),l(T.EVENT_LIST_RESOURCE_DELETE,e,wo,T))}function To(e,t,n){var r=t.key,o=ko(Ro(r));for(var a in n)n.hasOwnProperty(a)&&Array.prototype.push.apply(o,Co(r));Oo(o)}function go(e,t){$o(t.key)}function No(e,t){bo(t)}function So(e,t){bo(t)}function wo(e,t){$o(t.key)}function $o(e){var t=Ro(e);t.forEach(function(e){yr(e)})}function bo(e){var t=e.key,n=ko(Ro(t));Array.prototype.push.apply(n,Co(t)),Oo(n)}function Ro(t){var e=Sa("["+bi+"]"),n=[];return e.forEach(function(e){if(qr(e,t)){nr(e);n.push(e)}}),n}function ko(e){var t=[];return K(),e.forEach(function(e){document.body.contains(e)&&t.push(Ar(e))}),B(cc),t}function Co(t){var n=[],r=[];return K(),Jr().forEach(function(e){document.body.contains(e)&&(qr(kr(e),t)?n.push(Nr(e)):r.push(e))}),Br(r),B(cc),n}function Oo(e){e.forEach(function(e){to(e)})}function Lo(e,t){document.body.contains(e)&&!t.$f&&f(T.EVENT_META_RENDER,Vo,e)}function Vo(t){E(T.EVENT_META_RENDER,t),Po(t);var e=jr(t);if(e){var n=nr(t);switch(e.type){case eu:Do(t,n,Be(e.model));break;case tu:var r;(r=Wt([e.resource]))?Do(t,n,r[Object.keys(r)[0]]):Qt([e.resource],{},function(e){Do(t,n,e[Object.keys(e)[0]])})}}}function Po(e){e.querySelectorAll("select").forEach(function(e){Io(e)})}function Io(e){if(e.hasAttribute("value")){var t=e.getAttribute("value");if(n=e.querySelector('option[value="'+t+'"]'))return void(e.value=n.value)}var n;(n=e.querySelector("option[selected]"))&&(e.value=n.value)}function Do(t,e,n){e.$i=n;var r="function"==typeof t.onsubmit?t.onsubmit:null,o=Uo(t,e);t.onsubmit=r?function(){var e=r();return xo(t).length?o()&&e:e&&o()}:o,e.$f=!0}function Uo(n,r){return function(){if(n.hasAttribute(Ji))return!1;try{var t=xo(n);return Mo(n,t)&&(Ho(n,r),Zo(n,r,t),Ko(n,r),Ft(r.$i,function(e){Xo(n,r,t),g(T.EVENT_FORM_SUCCESS,n,e)},function(e){gu("Setu.forms ! form-submit",n),Xo(n,r,t),g(T.EVENT_FORM_ERROR,n,e)})),!1}catch(e){return!1}}}function Mo(e,t){var n=jo(e);return(e.error||e.getAttribute("error"))&&(n=!1),Go(t)&&n}function jo(e){return!c(T.ADAPTER_VALIDATE_FORM,e).contains(!1)}function xo(e){return e.getAttribute("name")?document.querySelectorAll('form[foreign-key="'+e.getAttribute("name")+'"]'):[]}function Go(e){var t,n=0;for(t=0;t<e.length;++t){var r=e[t],o=r.onsubmit;r.onsubmit=function(){return o(),!1},r.onsubmit(),r.onsubmit=o,r.error||r.hasAttribute("error")?++n:jo(r)||++n}return!n}function Ho(e,t){for(var n=e.elements,r={},o=Wo(t),a=0;a<n.length;++a){var i=n[a],u=i.getAttribute(ic);u&&u in o.def&&(r[u]=qo(o.name,u,o.def[u],i.value),""===r[u]&&o.def[u].blankIsNull&&(r[u]=null))}dt(o.name,o.def,r,t.$i),c(T.ADAPTER_TUNE_INSTANCE,e,t.$i)}function qo(e,t,n,r){var o=ye(e,t,n);switch(o){case ui:return zo(n.type,r);case ci:return""===r&&n.blankIsNull?null:zo(n.type,r);case ii:if(""===r&&n.blankIsNull)return null;var a=Fe(n.fk),i=a.pks[0];return qo(a.name,i,a.def[i],r);case ai:return eval(r)}}function zo(e,t){return uc.contains(e)?t:eval(t)}function Zo(e,t,n){n.length&&Fo(e,t,n[0].getAttribute(Ji));for(var r=0;r<n.length;++r){var o=n[r],a=nr(o);Ho(o,a),Bo(o,a,e,t)}}function Fo(e,t,n){var r=Wo(t),o=r.def[n],a=t.$i;Jo(r.name,n,o)?(a[n].splice(0,a[n].length),a[n]=[]):a[n]=i}function Jo(e,t,n){var r=ye(e,t,n);if(ai!==r)return!1;var o=ke(e,t,n.elements);return ii==o}function Bo(e,t,n,r){var o=e.getAttribute(Ji),a=t.$i,i=ut(a),u=r.$i,c=ut(u),f=i.$d?Pt(a,i):Lt(a,i);f&&(i.$d&&i.$m.pks.forEach(function(e){f[e]=a[e]}),s(u[o])?c.$d?c.$c[o].newVal.push(f):u[o].push(f):u[o]=f)}function Ko(e,t){e.hasAttribute(xi)&&(ut(t.$i).$qp=e.getAttribute(xi))}function Xo(e,t,n){if(e.hasAttribute(Di)){e.reset(),Yo(t);for(var r=0;r<n.length;++r){var o=n[r],a=nr(o);o.hasAttribute(Di)&&(e.reset(),Yo(a))}}}function Yo(e){e.$i=Be(Wo(e))}function Wo(e){return Fe(e.$i.__model__)}function Qo(e,t){if(!t.$c){var n=Mr(e);if(null===n)throw gu("Setu.clicks ! invalid",Ri,e.getAttribute(Ri),e),new Error(lu);ea(n,e),t.$c=!0}}function ea(t,o){switch(t.type){case Qi:$_(o).onclick(function(e){a(e);var t=sr(o);if(!t)throw gu("Setu.clicks ! cannot find context",o.getAttribute(Ri),o),new Error(lu);var n=null,r=null;if(o.hasAttribute(ki))try{n=eval(o.getAttribute(ki))}catch(e){}if(o.hasAttribute(Ci))try{r=o.getAttribute(Ci),r=eval(r)}catch(e){}Xt(t,n,r)});break;case nu:$_(o).onclick(function(e){a(e),eval(t.code)})}}function ta(){Sa("a[href]").forEach(function(t){var e=tr(t);if(e.$l)return!0;te(t.getAttribute("href").replace(/\?.*$/,""))&&$_(t).onclick(function(e){return a(e),la(t.getAttribute("href")),!1}),e.$l=!0})}function na(e){var t=ca(e,Gi),n=Setu.pageSizeParam||Setu.PAGE_SIZE_PARAM;$_(e).onchange(function(){ia(t,n,parseInt($_(e).value(),10))}),ua(t,e,n)}function ra(e){var r=ca(e,Hi),o=(Setu.pageSizeParam||Setu.PAGE_SIZE_PARAM,Setu.pageParam||Setu.PAGE_PARAM),t=1<r.page?1:null,n=2<r.page?r.page-2:null,a=1<r.page?r.page-1:null,i=r.last?null:r.page+1,u=!r.last&&r.count>(1+r.page)*r.value.length?r.page+2:null,c=r.last?null:r.count%r.value.length?r.count/r.value.length+1:r.count/r.value.length,f="";f+=t?"<a begin-sym enabled page=1>&laquo;</a>":"<a begin-sym disabled>&laquo;</a>",f+=a?"<a prev-sym enabled page="+a+">&lt;</a>":"<a prev-sym disabled>&lt;</a>",f+=n?"<a prev-prev enabled page="+n+">"+n+"</a>":"",f+=a?"<a prev enabled page="+a+">"+a+"</a>":"",f+="<a current disabled>"+r.page+"</a>",f+=i?"<a next enabled page="+i+">"+i+"</a>":"",f+=u?"<a next-next enabled page="+u+">"+u+"</a>":"",f+=i?"<a next-sym enabled page="+i+">&gt;</a>":"<a next-sym disabled>&gt;</a>",f+=c?"<a end-sym enabled page="+c+">&raquo;</a>":"<a end-sym disabled>&raquo;</a>",e.querySelectorAll("a").forEach(function(e){e.parentNode.removeChild(e)}),K(),$_(e).append(f),B(cc),e.querySelectorAll("a[enabled][page]").forEach(function(n){$_(n).onclick(function(e){var t=parseInt(n.getAttribute("page"),10);r.params=r.params||{},r.params[o]=t,cn(r),Xn(r)})})}function oa(e){var t=ca(e,qi);if(!e.hasAttribute(Fi))throw gu("Setu.list-modifiers ! invalid meta: no",Fi,qi,e),new Error(lu);var n=e.getAttribute(Fi);$_(e).onchange(function(){ia(t,n,$_(e).value())})}function aa(){Sa("["+qi+"]["+Fi+"]").forEach(function(e){var t=ca(e,qi),n=e.getAttribute(Fi);ua(t,e,n)})}function ia(e,t,n){var r=Setu.pageParam||Setu.PAGE_PARAM;e.params=e.params||{},n?e.params[t]=n:delete e.params[t],delete e.params[r],cn(e),Xn(e)}function ua(e,t,n){e.params[n]?$_(t).value(e.params[n].toString()):"select"===t.tagName.toLowerCase()&&Io(t)}function ca(e,t){var n,r=Hr(e,t);if(1!==r.length)throw gu("Setu.list-modifiers ! invalid meta",t,e),new Error(lu);if(!(n=bn(r[0].key)))throw gu("Setu.list-modifiers ! resource not available",t,e,r),new Error(pu);if(Ki!==n.type)throw gu("Setu.list-modifiers ! resource is not a list",t,e,n),new Error(lu);return n}function fa(e,t){if(!(cc=document.querySelector("["+$i+"]")))throw gu("Setu.application","no element with",$i,"attribute defined"),new TypeError(fu);fc=e,sc=cc.innerHTML,pe(t.config||{}),W(t.routes||{}),ze(t.models,t.modelFilters,t.config&&t.config.models),Yt(t.resources||{}),Ea()}function sa(){Ta(),Ea()}function la(e){L(e),Ea()}function pa(e){V(e),Ea()}function Ea(){da(),ma()}function da(){var e=Ee();u(e)&&"resources"in e&&e.resources.forEach(Nn),ee(),Kr(),mo(),_(),U(),_a()}function _a(){cc.innerHTML=sc}function ma(){Q(function(){ae()?ie()?pa(ue()):ce()?va():ga():ga()})}function va(){var t=fe();v({queryparams:ha()}),se()&&Ta(),Qt(le()||[],{},function(e){v(e),B(cc),Aa(t)})}function ha(){var n={};window.location.search&&window.location.search.replace(/^\?/,"").split("&").forEach(function(e){var t=e.split("=");n[decodeURIComponent(t[0])]=decodeURIComponent(t[1])});return n}function Aa(t){oc[t]?ya(oc[t]):q(t,{},function(e){ya(e.data),oc[t]=e.data},function(e){var t=JSON.parse(e.message);g(T.EVENT_AJAX_ERROR,null,{status:t.status,error:t.error})})}function ya(e){cc.innerHTML=e+sc,cc.querySelectorAll(_u).length||Yr()}function Ta(){Sn()}function ga(){B(cc),cc.querySelectorAll(_u).forEach(function(e){to(e)}),Xr()&&Yr()}function Na(e){return cc===e}function Sa(e){return cc.querySelectorAll(e)}if(Array.prototype.contains=function(e){return-1!==this.indexOf(e)},Array.prototype.remove=function(e,t){var n;-1!==(n=this.indexOf(e))&&this.splice(n,t||1)},Object.keys=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(n[a]=o[a])}return n},writable:!0,configurable:!0}),"function"!=typeof document.querySelector)throw gu("Setu.env ! document.querySelector not supported"),new Error(Eu);if("function"!=typeof document.querySelectorAll)throw gu("Setu.env ! document.querySelectorAll not supported"),new Error(Eu);if(!window.history||"function"==typeof!window.history.pushState||"function"==typeof!window.history.popState)throw gu("Setu.env ! no support for browsing history update"),new Error(Eu);var wa=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(!wa)throw gu("Setu.env ! no MutationObserver support in browser"),new Error(Eu);if("function"!=typeof Object.create)throw gu("Setu.env ! Object.create not supported"),new Error(Eu);var $a="application/json; charset=UTF-8",ba=1,Ra=3,ka=8,Ca="GET",Oa="POST",La="PATCH",Va="PUT",Pa="DELETE",Ia=["__model__","__key__"],Da="__sc",Ua="auto",Ma="fk",ja="elements",xa="null",Ga="optional",Ha="blankIsNull",qa="pk",za="type",Za="boolean",Fa="date",Ja="datetime",Ba="decimal",Ka="integer",Xa="string",Ya="time",Wa="uuid",Qa=[Ha,Ma,xa],ei=[Za,Fa,Ja,Ba,Ka,Xa,Ya,Wa],ti=[Ha,xa,Ga,za],ni=[Ua,qa,za],ri=[Ha,ja,Ga,za],oi=[xa,za],ai="array",ii="fk",ui="pk",ci="primitive",fi="fields",si="filters",li="instanceFks",pi=/^({([a-z][0-9a-zA-Z_]*)})?([A-Za-z][0-9a-zA-Z_]+)(:(([^,:|=]+)|([a-z][0-9a-zA-Z_]*=[^;:|=]+(;[a-z][0-9a-zA-Z_]*=[^;:|]+)*)))?(\|([a-z][0-9a-zA-Z_]*=[^;=]+(;[a-z][0-9a-zA-Z_]*=[^;=]+)*))?$/,Ei=/({{[^{}]+}})/g,di=/({%{[^{}]+}%})/g,_i=/^setu\-([a-z])([a-z]+)$/,mi=/([a-zA-Z][a-zA-Z0-9_\.]*)[\s]*in[\s]*([a-zA-Z][a-zA-Z0-9_\.]+)/,vi=/([a-zA-Z][a-zA-Z0-9_]*)[\s]*=[\s]*(.*)+/,hi=/^list::([A-Za-z][A-Za-z0-9_]+)(\|([a-z][0-9a-zA-Z_]*=[^,=]+(,[a-z][0-9a-zA-Z_]*=[^,=]+)*))?$/,Ai=/^create::([A-Z][A-Za-z0-9_]+)$/,yi=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,Ti=/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01])[T ](0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?(\.\d+)?(Z|[+-](0\d|1[0-2]):?[0-5]\d)?$/,gi=/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01])$/,Ni=/^(0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?(\.\d+)?(Z|[+-](0\d|1[0-2]):?[0-5]\d)?$/,Si="one",wi="multi",$i="setu-app",bi="setu-bind",Ri="setu-click",ki="setu-delete-callback",Ci="setu-delete-param",Oi="setu-declare",Li="setu-if",Vi="setu-include",Pi="setu-instance",Ii="setu-loop",Di="setu-model",Ui="setu-pass",Mi="setu-require",ji="setu-replace",xi="setu-params",Gi="setu-pagesize",Hi="setu-pageset",qi="setu-filter",zi=[bi,Ri,Oi,Li,Vi,Pi,Ii,Di,Ui,Mi,Gi,Hi,qi],Zi="setu-content",Fi="filter-param",Ji="related-as",Bi="api",Ki="list",Xi="detail",Yi="create",Wi="update",Qi="delete",eu="model",tu="instance",nu="code",ru="parseFallThrough",ou="parseDone",au="parsePending",iu="parseError",uu="parseRemoved",cu="parseReplaced",fu="Improperly configured Setu application",su="Invalid instance data",lu="Invalid Setu meta syntax",pu="Setu internal error",Eu="This browser does not support the Setu framework",du=[];zi.forEach(function(e){du.push("["+e+"]")});var _u=du.join(",");T.MULTI_PK_TO_URL_KEY_VALUE_PATH="KeyValuePath",T.MULTI_PK_TO_URL_ORDERED_VALUES_PATH="OrderedValuesPath",T.MULTI_PK_TO_URL_ORDERED_SEPERATED_VALUES="OrderedSeparatedValues",T.EVENT_LIST_RESOURCE_CREATE="listResourceCreate",T.EVENT_LIST_RESOURCE_CHANGE="listResourceChange",T.EVENT_LIST_RESOURCE_DELETE="listResourceDelete",T.EVENT_DETAIL_RESOURCE_CHANGE="detailResourceChange",T.EVENT_DETAIL_RESOURCE_DELETE="detailResourceDelete",T.EVENT_INSTANCE_CHANGE="instanceChange",T.EVENT_INSTANCE_CREATE="instanceCreate",T.EVENT_INSTANCE_DELETE="instanceDelete",T.EVENT_META_RENDER="metaRender",T.EVENT_PAGE_BEGIN="pageBegin",T.EVENT_PAGE_RENDER="pageRender",T.EVENT_FRAGMENT_CHANGE="fragmentChange",T.EVENT_FORM_SUCCESS="formSuccess",T.EVENT_FORM_ERROR="formError",T.EVENT_AJAX_ERROR="ajaxError",T.ADAPTER_AJAX_BEFORE_SEND="ajaxBeforeSend",T.ADAPTER_AJAX_ON_RESPONSE="ajaxOnResponse",T.ADAPTER_MODELS_LIST="modelsList",T.ADAPTER_VALIDATE_FORM="__forms__validate",T.ADAPTER_TUNE_INSTANCE="tuneInstance",T.PAGE_PARAM="page",T.PAGE_SIZE_PARAM="page_size";var mu={error:1,warn:2,info:3,log:4},vu=mu.log;console.debug=console.debug||n,console.time=console.time||n,console.timeEnd=console.timeEnd||n;var hu=console.time||n,Au=console.timeEnd||n,yu=console.info||n,Tu=console.warn||n,gu=console.error||n,Nu={};T.adapters={};var Su={},wu={};Su[T.EVENT_LIST_RESOURCE_CREATE]=[],Su[T.EVENT_FORM_SUCCESS]=[],Su[T.EVENT_FORM_ERROR]=[],Su[T.EVENT_AJAX_ERROR]=[],Su[T.EVENT_PAGE_RENDER]=[],Su[T.EVENT_PAGE_BEGIN]=[],Su[T.EVENT_META_RENDER]=[],Su[T.EVENT_FRAGMENT_CHANGE]=[],wu[T.EVENT_DETAIL_RESOURCE_CHANGE]={},wu[T.EVENT_DETAIL_RESOURCE_DELETE]={},wu[T.EVENT_INSTANCE_CHANGE]={},wu[T.EVENT_INSTANCE_CREATE]={},wu[T.EVENT_INSTANCE_DELETE]={},wu[T.EVENT_LIST_RESOURCE_CHANGE]={},wu[T.EVENT_LIST_RESOURCE_DELETE]={},T.register=f,T.unregister=E;var $u=window,bu={},Ru;T.set=function(e,t){m(e,t),h()};var ku={datetime:e},Cu,Ou;window.onpopstate=function(e){e.state&&e.state.pathname&&(k(e.state,GLastUrl||{})?g(T.EVENT_FRAGMENT_CHANGE,T):(Cu=e.state,Ea()),D())},L(window.location.pathname+window.location.search+window.location.hash,{pathname:window.location.pathname,search:window.location.search,fragment:window.location.hash}),T.fragment=O;var Lu={},Vu=!1,Pu=new wa(function(e){X(e)}),Iu,Du,Uu,Mu,ju,xu,Gu;T.models={},T.models.NameResolutionDefault={m2p:function(e){return e.replace(/^([A-Z])/,function(e){return e.toLowerCase()}).replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})+"s"},p2m:function(e){return e.replace(/^([a-z])/,function(e){return e.toUpperCase()}).replace(/(-[a-z])/g,function(e){return e.charAt(1).toUpperCase()}).replace(/s$/,"")},m2i:function(e){return e.replace(/^([A-Z])/,function(e){return e.toLowerCase()}).replace(/([A-Z])/g,function(e){return"_"+e.toLowerCase()})},i2m:function(e){return e.replace(/^([a-z])/,function(e){return e.toUpperCase()}).replace(/(_[a-z])/g,function(e){return e.charAt(1).toUpperCase()})},m2l:function(e){return this.m2i(e)+"s"},l2m:function(e){return this.i2m(e).replace(/s$/,"")}};var Hu={},qu={},zu=0,Zu={},Fu=0,Ju,Bu;T.imeta=lt;var Ku={};T.get=Qt,T.getByKey=bn,T.reloadList=Xn;var Xu={},Yu=0,Wu={},Qu=0,ec=[Ki,Xi,Bi],tc=[],nc=0,rc=!1,oc={},ac={};f(T.EVENT_LIST_RESOURCE_CREATE,No,T);var ic="name",uc=[Xa,Ja,Fa,Ya,Wa],cc,fc,sc;T.run=fa,T.refresh=sa,T.open=la,T.clear=Kr,T.app=cc}(window.Setu=window.Setu||{}),$_.ready(function(){Setu.adapters.Django=[{purpose:Setu.ADAPTER_AJAX_BEFORE_SEND,handler:function(e,t,n,r){if(!/^(http__get|HEAD|OPTIONS|TRACE)$/.test(n.method)&&!r.crossDomain){var o=document.cookie.match(new RegExp("csrftoken=([^;]+)"));o&&t.setRequestHeader("X-CSRFToken",o[1])}}}]}),$_.ready(function(){function a(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e,t){for(var n=e.replace(/^[^\?]*\?/,"").split("&"),r=1,o=0;o<n.length;++o){var a=n[o].split("=");if(t===a[0]){r=parseInt(a[1],10);break}}return r}Setu.adapters.DjangoRestFramework=[{purpose:Setu.ADAPTER_MODELS_LIST,handler:function(e,t){if(data=t.data,function(e){return"object"==typeof e&&!a(e)}(data)){var n,r=Setu.pageParam||Setu.PAGE_PARAM,o=!1;return data.next?n=i(data.next,r)-1:o=(n=data.previous?i(data.previous,r)+1:1,!0),{page:n,last:o,count:data.count,list:data.results}}if(a(data))return{page:1,last:!0,count:data.length,list:data}}}]});