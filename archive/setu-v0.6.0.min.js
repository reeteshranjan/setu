!function(y,i){function s(e){return"[object Array]"===Object.prototype.toString.call(e)}function u(e){return"object"==typeof e&&!s(e)}function a(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()}function n(){}function t(e){for(e in Lu[e]&&(Vu=Lu[e]),Lu)Lu[e]<=Vu?console[e]=console[e]||n:console[e]=n;Iu=r("time","error"),Du=r("timeEnd","error"),console.time=r("time","error"),console.timeEnd=r("timeEnd","error"),Pu=console.info,Uu=console.warn,ju=console.error}function r(e,t){return console[e]&&n!==console[t]?console[e]:n}function o(e,t,n){Mu[e]=Mu[e]||[],Mu[e].push([n,t])}function c(e){if(!Mu[e])return[];var t=Array.prototype.slice.apply(arguments),n=[];return Mu[e].forEach(function(e){t[0]=e[0],n.push(e[1].apply(null,t))}),n}function f(e,t,n){xu[e].contains(n)||(xu[e].push(n),xu[e].push(t))}function l(e,t,n,r){Gu[e][t]=Gu[e][t]||[],Gu[e][t].contains(r)||(Gu[e][t].push(r),Gu[e][t].push(n))}function N(e,t,n){for(var r=xu[e].slice(),o=0;o<r.length;o+=2)try{r[o+1](r[o],t,n)}catch(e){}}function p(e,t,n,r){var o=Gu[e][t];if(o){o=o.slice();for(var a=0;a<o.length;a+=2)try{o[a+1](o[a],n,r)}catch(e){}}}function E(e,t){xu[e].remove(t,2)}function d(e,t,n){var r=Gu[e][t];r&&r.remove(n,2)}function _(){for(var e in qu)delete qu[e];qu={},zu=i}function m(e,t){qu[e]=t}function v(e){var t={};for(var n in e)if(e.hasOwnProperty(n)&&(!qu.hasOwnProperty(n)||qu[n]!==e[n])){var r=e[n];m(n,r),t[n]=r}return t}function h(){for(var e in zu=Hu.event,qu)Hu[e]=qu[e]}function A(){for(var e in qu)Hu.hasOwnProperty(e)&&delete Hu[e];Hu.event=zu}function T(e){for(var t in e)e.hasOwnProperty(t)&&delete qu[t]}function g(e,t){var n=v(e);h();var r=t.replace(ki,function(e){return S(e)});return r=r.replace(Ci,function(e){return S(e,!0)}),A(),T(n),r}function S(t,e){var n;n=(n=e?t.replace(/^{!{/,"").replace(/}!}$/,""):t.replace(/^{{/,"").replace(/}}$/,"")).replace(/\s*\|\s*/,"|").trim(),parts=n.split("|");try{var r=w(parts);return e?r||t:i!==r?r:t}catch(e){return t}}function w(e){var t=eval(e[0]);if(i===t)return i;for(var n=1;n<e.length;++n){var r=e[n];if(!R(r))return i;if(t=k(r,t),i===t)return i}return t}function $(e,t){var n=v(e),r;h();try{r=Br(t)?eval(g({},t)):eval(t)}catch(e){r=t}return A(),T(n),r}function b(e){return new Date(e).toISOString()}function R(e){return e in Zu}function k(e,t){return Zu[e](t)}function C(e,t){return e.pathname===t.pathname&&e.search===t.search}function O(e){var t=e.match(/#/)?e.replace(/^.*#/g,"#"):"",n=t?e.replace(/#.*$/g,""):e,r=n.match(/\?/)?n.replace(/^.*\?/g,"?"):"";return{pathname:r?n.replace(/\?.*$/g,""):n,search:r,fragment:t}}function L(e){V(window.location.pathname+window.location.search+"#"+e,{pathname:window.location.pathname,search:window.location.search,fragment:"#"+e})}function V(e,t){t=t||O(e),window.history.pushState(t,"",e),U()}function I(e){var t=O(e);window.history.replaceState(t,"",e),U()}function D(){return Fu&&Fu.pathname?Fu.pathname:null}function P(){Fu=null}function U(){GLastUrl={pathname:window.location.pathname,search:window.location.search,fragment:window.location.hash}}function j(){Bu={}}function M(e,t,n,r,o){(n=n||{}).method=e||Za,n.cache=n.cache||!1,n.beforeSend=n.beforeSend||function(e,t){H(),c(y.ADAPTER_AJAX_BEFORE_SEND,e,t,this)},x(n,t,e,r),G(n,t,e,o),$_.ajax(t,n)}function x(e,a,i,u){e.success=function(t,n,r,o){q();try{c(y.ADAPTER_AJAX_ON_RESPONSE,t,n,r,o)}catch(e){}try{"function"==typeof u&&u({data:t,status:n,xhr:o,url:r}),Za===i&&a in Bu&&(Bu[a].forEach(function(e){"function"==typeof e.onsuccess&&e.onsuccess({data:t,status:n,xhr:o,url:r})}),delete Bu[a])}catch(e){ju("Setu.http ! error onsuccess",e.message,e.stack),Za===i&&delete Bu[a]}}}function G(e,a,i,u){e.error=function(e,t,n,r){ju("Setu.http ajax !",n,i,t,e),q();try{c(y.ADAPTER_AJAX_ON_RESPONSE,e,t,n,r)}catch(e){}var o=JSON.stringify({status:t,error:e,url:n});try{"function"==typeof u&&u(Error(o)),Za===i&&a in Bu&&(Bu[a].forEach(function(e){"function"==typeof e.onerror&&e.onerror(Error(o))}),delete Bu[a])}catch(e){ju("Setu.http ! error onerror",e.message,e.stack),Za===i&&delete Bu[a]}("number"!=typeof t||t<400)&&N(y.EVENT_AJAX_ERROR,null,{status:t,error:e})}}function H(){if("function"==typeof y.appAjaxStart)try{y.appAjaxStart()}catch(e){}}function q(){if("function"==typeof y.appAjaxEnd)try{y.appAjaxEnd()}catch(e){}}function z(e,t,n,r){Bu[e]?Bu[e].push({onsuccess:n,onerror:r}):(Bu[e]=[],M(Za,e,t,n,r))}function Z(e,t,n,r){M(Fa,e,t,n,r)}function F(e,t,n,r){M(Ja,e,t,n,r)}function J(e,t,n,r){M(Ba,e,t,n,r)}function B(e,t,n,r){M(Ka,e,t,n,r)}function K(e){e&&document.body.contains(e)&&Xu.observe(e,{childList:!0,subtree:!0})}function X(){Xu.disconnect()}function Y(e){Ku=!1,e.forEach(function(e){e.addedNodes&&e.addedNodes.forEach(function(e){Ha===e.nodeType&&document.body.contains(e)&&zr(e)&&(Ku=!0,Eo(e))})}),W()&&(co()&&fo(),Ku=!1)}function W(){return Ku}function Q(e){Yu=e,te()}function ee(e){var t;re(),(t=ne(Qu))?oe(t,e):e()}function te(){Wu=Qu=i}function ne(e){if(Yu[e])return Yu[e];for(var t in Yu)if(e.match(new RegExp(t)))return Yu[t];return!1}function re(){var e=D();e?(Qu=e,P()):Qu=location.pathname.replace(/\/$/,"")}function oe(e,t){"function"==typeof e?e(function(e){ae(e,t)}):ae(e,t)}function ae(e,t){Wu=e,t()}function ie(){return Wu}function ue(){return Wu.redirect}function ce(){return Wu.redirect}function fe(){return Wu.include}function se(){return Wu.include}function le(){return Wu.flush}function pe(){return Wu.require}function Ee(e){(ec=e).logLevel&&t(ec.logLevel),ec.adapters&&ec.adapters.forEach(function(e){y.adapters[e].forEach(function(e){o(e.purpose,e.handler)})})}function de(){return ec.pathchange&&ec.pathchange.flush?ec.pathchange.flush:i}function _e(e){for(var t in e)if(e.hasOwnProperty(t)){var n=me(e,t);Fe(t,Ve(n,t,Oe(t,n),Le(t,n)))}}function me(e,t){var n=ve(e,t);for(var r in he(t,n),n)n.hasOwnProperty(r)&&Ae(e,t,n,r);return n}function ve(e,t){var n=e[t];if(!u(n))throw ju("Setu.mparse !",t,"model definition must be an object",n),new TypeError(wu);return n}function he(t,n){Xa.forEach(function(e){if(e in n)throw ju("Setu.mparse !",e,"is used as a field in model",t,"but it is reserved"),new TypeError(wu)})}function Ae(e,t,n,r){var o=Te(t,n,r);switch(ye(t,r,o)){case gi:Ne(t,r,o,mi);break;case Ni:ge(t,r,o);break;case yi:Se(e,t,r,o);break;case Ti:we(e,t,r,o)}}function Te(e,t,n){var r=t[n];if(!u(r))throw ju("Setu.mparse !",e,"model field",n,"definition is not an object",r),new TypeError(wu);return r}function ye(e,t,n){return $e(e,t,n),ai in n?Ti!==n.type?oi in n?Ni:gi:Ti:yi}function Ne(e,t,n,r){Re(e,t,n,_i),ke(e,t,n,r)}function ge(e,t,n){Ne(e,t,n,vi)}function Se(e,t,n,r){be(e,t,n,r),ke(t,n,r,di)}function we(e,t,n,r){switch(ke(t,n,r,hi),Ce(t,n,r.elements)){case gi:Ne(t,n,r.elements,Ai);break;case yi:Se(e,t,n,r.elements)}}function $e(e,t,n){if(ai in n&&Qa in n)throw ju("Setu.mparse !",'both "type" and "fk" are defined in',n,"in model",e,"field",t),new TypeError(wu);if(!(ai in n||Qa in n))throw ju("Setu.mparse !",'none of "type" and "fk" are defined in',n,"in model",e,"field",t),new TypeError(wu)}function be(e,t,n,r){if(!(r.fk in e))throw ju("Setu.mparse !","model",r.fk,"referred to in",r,"as a foreign key field",n,"in model",t,"does not exist"),new TypeError(wu)}function Re(e,t,n,r){if(!r.contains(n.type))throw ju("Setu.mparse !","unsupported type",n.type,"in",n,"in model",e,"field",t,"allowed ones are:",r),new TypeError(wu)}function ke(e,t,n,r){for(var o in n)if(n.hasOwnProperty(o)&&!r.contains(o))throw ju("Setu.mparse !","unsupported parameter",o,"in",n,"in model",e,"field",t,"allowed ones are:",r),new TypeError(wu)}function Ce(e,t,n){return $e(e,t,n),n.type?gi:yi}function Oe(e,t){var n=[];for(var r in t)t.hasOwnProperty(r)&&t[r].pk&&n.push(r);if(!n.length)throw ju("Setu.mparse !","model",e,"does not have any primary keys defined"),new TypeError(wu);return n}function Le(e,t){var n={};for(var r in t)t.hasOwnProperty(r)&&t[r].fk&&(n[r]=t[r].fk);return n}function Ve(e,t,n,r){var o={};return o.name=t,o.prefix=Me()+"/"+xe(o.name),o.def=e,o.pks=n,o.fks=r,o.iType=Ie(o),o}function Ie(e){var t={};for(var n in e.def)e.def.hasOwnProperty(n)&&(t[n]={get:tt(n),set:nt(n),enumerable:!0});return t.__model__={value:e.name,writable:!1,enumerable:!1,configurable:!1},t}function De(e,t){nc=t||{trailingSlash:!0,nameResolution:"Setu.models.NameResolutionDefault",urlPrefix:"",compositePkToUrl:y.MULTI_PK_TO_URL_KEY_VALUE_PATH,compositePkSeparator:"_",validateInstances:!0},nc.updateLists=nc.updateLists||{updateLists:{fields:{},filters:{},instanceFks:{}}},nc.updateLists.fields=nc.updateLists.fields||{},nc.updateLists.filters=nc.updateLists.filters||{},nc.updateLists.instanceFks=nc.updateLists.instanceFks||{},tc=e||{},rc=eval(nc.nameResolution)}function Pe(e,t){var n=tc[e.__model__];return n&&"function"==typeof n[t]?n[t](e):i}function Ue(e,t,n){var r=nc.updateLists[e][t];return r&&n&&(r=r[n.__model__]),r}function je(){return nc.trailingSlash?"/":""}function Me(){return nc.urlPrefix}function xe(e){return rc.m2p(e)}function Ge(e){return rc.m2i(e)}function He(e){return rc.m2l(e)}function qe(){return nc.compositePkToUrl}function ze(){return nc.compositePkSeparator}function Ze(e,t,n){De(t,n),_e(e)}function Fe(e,t){oc[e]=t}function Je(e){if(!oc[e])throw ju("Setu.models ! model",e,"not defined by application"),new TypeError(wu);return oc[e]}function Be(e){return oc[e]}function Ke(e){var t=it();e.iType.__meta_idx__={value:t,writable:!0,enumerable:!1,configurable:!1};var n=Object.create(Object.prototype,e.iType);return delete e.iType.__meta_idx__,bt(n),n}function Xe(e,t){return e.prefix+je()+(t?"?"+t:"")}function Ye(e,t,n,r){return e.prefix+"/"+We(t,n)+je()+(r?"?"+r:"")}function We(e,t){return xi===t?e:Qe(e)}function Qe(e){switch(qe()){case y.MULTI_PK_TO_URL_KEY_VALUE_PATH:return e.replace(/,/,"/");case y.MULTI_PK_TO_URL_ORDERED_VALUES_PATH:return et(e,"/");case y.MULTI_PK_TO_URL_ORDERED_SEPERATED_VALUES:return et(e,ze()||"_")}}function et(e,t){var n=e.split(","),r=[];return n.forEach(function(e){r.push(e.replace(/^[^=]+=/,""))}),r.join(t)}function tt(e){return function(){return ac[ct(this).$i[e]]}}function nt(o){return function(e){var t=ct(this),n=t.$i[o],r=ac[n];if(r!==e){if(!t.$d||t.$s)return void(ac[n]=e);t.$c[o]={oldVal:r,newVal:e}}else delete t.$c[o]}}function rt(e){return ac[ic]=e,ic++}function ot(){return Object.keys(ac).length}function at(e){delete ac[e]}function it(){return cc++}function ut(e){var t=uc[e.__meta_idx__]={};return t.$m=Je(e.__model__),t.$i={},t.$c={},t}function ct(e){return uc[e.__meta_idx__]}function ft(){return Object.keys(uc).length}function st(e,t,n){delete uc[e.__meta_idx__],e.__meta_idx__=n,t.$k=n,uc[n]=t}function lt(e){delete uc[e.__meta_idx__]}function pt(){for(var e in uc);}function Et(e,t,n,r){for(var o in t)if(dt(t[o],r)&&!(o in n))throw ju("Setu.iparse ! instance data",n,"for model",e,"does not have required field",o),new TypeError($u)}function dt(e,t){return e.pk&&!t&&!e.auto||e.fk||!e.optional}function _t(e,t,n,r){for(var o in n)o in t&&(mt(e,o,t[o],n),r[o]=n[o])}function mt(e,t,n,r){switch(ye(e,t,n)){case gi:vt(e,t,n,r);break;case Ni:ht(e,t,n,r);break;case yi:At(e,t,n,r);break;case Ti:yt(e,t,n,r)}}function vt(e,t,n,r){var o=n.type,a=r[t];if(wt(a,n))throw ju("Setu.iparse !",e,"model field",t,"is null in",r,"which is not allowed"),new TypeError($u);if(null!==a&&!$t(a,o))throw ju("Setu.iparse !",e,"model field",t,"is",a,"in",r,"which is not of required type:",o),new TypeError($u)}function ht(e,t,n,r){vt(e,t,n,r)}function At(e,t,n,r){var o=Je(n.fk);if(u(r[t])){_t(o.name,o.def,r[t],{})}else{var a=o.pks[0];Tt(o.name,a,o.def[a],e,t,n,r)}}function Tt(e,t,n,r,o,a,i){var u=n.type,c=i[o];if(wt(c,a))throw ju("Setu.iparse !",r,"model field",o,"is a foreign key to",e,"and is null in",i,"which is not allowed"),new TypeError($u);if(null!==c&&!$t(c,u))throw ju("Setu.iparse !",r,"model field",o,"is a foreign key to",e,"whose primary key",t,"is of type",u,"but the value is",c,"in",i),new TypeError($u)}function yt(e,t,n,r){if(!s(r[t]))throw ju("Setu.iparse !",e,"model field",t,"must be an array but the value is",r[t],"in",r),new TypeError($u);switch(Ce(e,t,n.elements)){case gi:Nt(e,t,n.elements,r);break;case yi:gt(e,t,n.elements,r)}}function Nt(t,n,r,o){var a=r.type;o[n].forEach(function(e){if(wt(e,r))ju("Setu.iparse !",t,"model array field",n,"contains a null element in",o,"which is not allowed");else if(null!==e&&!$t(e,a))throw ju("Setu.iparse !",t,"model array field",n,"has",e,"in",o,"which is not of required type:",a),new TypeError($u)})}function gt(r,e,o,a){a[e].forEach(function(e){var t=Je(o.fk);if(u(e)){_t(t.name,t.def,e,{})}else{var n=t.pks[0];St(t.name,n,t.def[n],r,e,o,a)}})}function St(e,t,n,r,o,a,i){var u=n.type;if(wt(o,a))throw ju("Setu.iparse !",r,"model field",field,"contains foreign keys to",e,"and cannot have nulls","but nulls are there in",i),new TypeError($u);if(null!==o&&!$t(o,u))throw ju("Setu.iparse !",r,"model field",field,"contains foreign keys to",e,"whose primary key",t,"is of type",u,"but value of an array element",o,"in",i,"does not match the type"),new TypeError($u)}function wt(e,t){return null===e&&!t.null}function $t(e,t){switch(t){case ii:case li:return t===typeof e;case si:return"number"==typeof e&&!e.toString().match(/\./);case fi:return"number"==typeof e;case ci:return"string"==typeof e&&e.match(Ui);case ui:return"string"==typeof e&&e.match(ji);case pi:return"string"==typeof e&&e.match(Mi);case Ei:return"string"==typeof e&&e.match(Pi)}return!1}function bt(e){var t=ut(e),n=t.$m;for(var r in n.def){var o="array"!==n.def[r].type?i:[];t.$i[r]=rt(o)}}function Rt(e){var t=Je(e.__model__),n=ct(e);for(var r in t.def){at(n.$i[r])}lt(e)}function kt(e,t,n){if(t){var r=e.__model__;model=Je(r),modelDef=model.def,imeta=ct(e),Et(r,modelDef,t,imeta.$d),_t(r,modelDef,t,e),imeta.$d=!0,st(e,imeta,r+":"+Ct(e)),n||Cn(e,imeta)}}function Ct(t){var e=Je(t.__model__);if(1===e.pks.length)return t[e.pks[0]];var n=[];return e.pks.forEach(function(e){n.push(e+"="+t[e])}),n.join(";")}function Ot(e){var t=e.split(";"),n={};return t.forEach(function(e){var t=e.split("=");n[t[0]]=t[1]}),n}function Lt(e,t,n){return!t.$d||(ju("Setu.instances","internal programming error or user-forced recreation of an already created instance",e),n(e),!1)}function Vt(e,t){var n={},r=t.$m.def;for(var o in r)r.hasOwnProperty(o)&&!r[o].auto&&(n[o]=e[o]);return n}function It(e,t,n){return!!t.$d||(ju("Setu.instances","internal programming error or user forced update of an instance that does not exist in backend",e),n(e),!1)}function Dt(e,t){var n={};for(var r in t.$c)t.$c.hasOwnProperty(r)&&(n[r]=t.$c[r].newVal);return Object.keys(n).length?n:null}function Pt(e,t){if(Object.keys(t.$c).length){var n={};for(var r in t.$c)n[r]=t.$c[r];for(var r in t.$s=!0,n)e[r]=n[r].newVal;return t.$s=!1,t.$c={},n}}function Ut(e,t){var n=t.$m.prefix+je();return t.$qp&&(n+="?"+t.$qp,delete t.$qp),n}function jt(e,t){var n=t.$m,r=1===n.pks.length?xi:Gi,o=Ye(n,Mt(n,r,e),r,t.$qp);return t.$qp&&delete t.$qp,o}function Mt(e,t,n){return xi===t?n[e.pks[0]]:xt(e.pks,n)}function xt(e,t){var n=[];return e.forEach(function(e){n.push(e+"="+t[e])}),n.join(",")}function Gt(e){Rn(ct(e).$k),Rt(e)}function Ht(e){var t={},n=imeta.$m.def;for(var r in n)n.hasOwnProperty(r)&&(t[r]=e[r]);return t}function qt(t,e,n,r){z(Xe(t,e=e||""),{format:"json"},function(e){zt(t,e,n)},function(e){"function"==typeof r&&r([])})}function zt(n,e,t){var r=c(y.ADAPTER_MODELS_LIST,e)[0],o=[];r.list.forEach(function(e){var t=Ke(n);kt(t,e),o.push(t)}),t(o,r.page,r.last,r.count)}function Zt(t,e,n,r,o,a){z(Ye(t,e,n,r),{format:"json"},function(e){Ft(t,e,o)},function(e){"function"==typeof a&&a({})})}function Ft(e,t,n){var r=t.data,o=Ke(e);kt(o,r,!0),n(o)}function Jt(t,e,n,r,o,a,i){var u=Ye(e,n,r,o),c=ct(t);z(u,{format:"json"},function(e){Qt(t,c,e),a()},function(e){i()})}function Bt(e,t,n,r){z(e+(t?"?"+t:""),{format:"json"},function(e){n(e.data)},function(e){"function"==typeof r&&r({})})}function Kt(e,t,n){var r=ct(e);return r.$d?Yt(e,r,t,n):Xt(e,r,t,n)}function Xt(n,e,r,t){Lt(n,e,r)&&Z(Ut(n,e),{data:Vt(n,e),contentType:Ga,format:"json"},function(e){kt(n,e.data);var t=Ht(n);p(y.EVENT_INSTANCE_CREATE,n.__model__,n),r(t)},function(e){"function"==typeof t&&t(JSON.parse(e.message))})}function Yt(n,r,o,t){if(It(n,r,o)){var e=Dt(n,r);e&&F(jt(n,r),{data:e,contentType:Ga,format:"json"},function(e){var t=Wt(n,r,e);o(t)},function(e){"function"==typeof t&&t(JSON.parse(e.message))})}}function Wt(e,t,n){var r=n.data,o=t.$m.def,a=e.__model__;t.$s=!0,_t(a,o,r,e),t.$s=!1;var i=Ht(e);return p(y.EVENT_INSTANCE_CHANGE,t.$k,e,t.$c),p(y.EVENT_INSTANCE_CHANGE,e.__model__,e,t.$c),t.$c={},i}function Qt(e,t,n){var r=n.data,o=t.$m.def;if(_t(e.__model__,o,r,e),Object.keys(t.$c).length){var a=Pt(e,t);p(y.EVENT_INSTANCE_CHANGE,t.$k,e,a),p(y.EVENT_INSTANCE_CHANGE,e.__model__,e,a)}}function en(t,n,r){var o=ct(t);B(jt(t,o),{format:"json"},function(e){p(y.EVENT_INSTANCE_DELETE,o.$k,t),p(y.EVENT_INSTANCE_DELETE,t.__model__,t),Gt(t),"function"==typeof n&&n(r)},function(e){})}function tn(e){sc=e,fc={}}function nn(e){if(!e||!e.length)return!1;var r={};return e.every(function(e){var t,n=e.title;return(t=fc[e.key])&&t.value?(r[n]=t.value,!0):r=!1}),r}function rn(n,r,o){if(n&&n.length){var a={};n.forEach(function(e){var t="string"==typeof e?on(r,e):e;vn(t=mn(t),function(e){a[e.title]=e.value,Object.keys(a).length===n.length&&o(a)})})}else o({})}function on(e,t){var n=sc[t];return n?an(t,n):un(e,t)}function an(e,t){return{type:su,key:e,title:e,api:t}}function un(e,t){var n={},r=t,o=fn(t=cn(t,e),r);n.key=sn(o);var a=Be(o[3]),i=sc[o[3]];if(!a&&!i)throw ju("Setu.resources ! invalid resource key",r,t),new TypeError(wu);return ln(o,n),a?(n.model=a,dn(o,n),n.title=o[2]||_n(n)):(n.api=i,n.title=o[2]||n.key,n.type=su),n}function cn(e,t){if(Br(e))try{e=g(t,e)}catch(e){}return e}function fn(e,t){var n=e.match(Ri);if(!n||12!==n.length)throw ju("Setu.resources !","invalid key",t),new TypeError(bu);return n}function sn(e){return e[3]+(e[5]?":"+e[5]:"")+(e[10]?"|"+e[10]:"")}function ln(e,t){e[10]&&(t.params=En(e[10]),t.queryparams=e[10].replace(/;/g,"&"))}function pn(e){if(e.params){var t=[];for(var n in e.params)t.push(n+"="+e.params[n]);e.queryparams=t.join("&")}}function En(e){var t=e.split(";"),n={};return t.forEach(function(e){var t=e.match(/^([^=]+)=(.*)$/);n[t[1]]=t[2]}),n}function dn(e,t){e[5]?(t.pk=e[5],t.pkType=e[5].match(/,/)?Gi:xi,t.type=pu):t.type=lu}function _n(e){return pu===e.type?Ge(e.model.name):He(e.model.name)}function mn(e){if(fc[e.key]){var t=e.title;t!=(e=fc[e.key]).title&&(e.title=t)}else fc[e.key]=e;return e}function vn(e,t){switch(e.type){case lu:hn(e,t);break;case pu:Tn(e,t);break;case su:Nn(e,t)}}function hn(a,i,e){if(a.value&&!e)i(bn(a));else{if(gn(a))return void wn(a,i);Sn(a),qt(a.model,a.queryparams,function(e,t,n,r){a.value=a.value||[],e.forEach(function(e){a.value.push(e)}),a.fetched_at=(new Date).getTime(),a.page=t||1,a.last=n,a.count=r,In(a);var o=bn(a);$n(a,o),i(o)},function(e){var t={title:a.title,value:e};$n(a,t),i(t)})}}function An(e,t){for(;e.value.length;)Gt(e.value.pop());hn(e,t,!0)}function Tn(n,r){if(n.value)r(bn(n));else{if(gn(n))return void wn(n,r);Sn(n),Zt(n.model,n.pk,n.pkType,n.queryparams,function(e){n.value=e,n.fetched_at=(new Date).getTime(),rr(n);var t=bn(n);$n(n,t),r(t)},function(e){var t={title:n.title,value:e};$n(n,t),r(t)})}}function yn(t,n){gn(t)?wn(t,n):(Sn(t),Jt(t.value,t.model,t.pk,t.pkType,t.queryparams,function(){t.fetched_at=(new Date).getTime();var e=bn(t);$n(t,e),"function"==typeof n&&n(e)},function(){var e=bn(t);$n(t,e)}))}function Nn(n,r){n.value?r(bn(n)):Bt(n.api,n.queryparams,function(e){n.value=e;var t=bn(n);r(t)},function(e){r({title:n.title,value:e})})}function gn(e){return e.key in lc}function Sn(e){lc[e.key]=[]}function wn(e,t){lc[e.key].push(t)}function $n(e,t){if(e.key in lc){var n=lc[e.key].slice();delete lc[e.key],n.forEach(function(e){"function"==typeof e&&e(t)})}}function bn(e){return{title:e.title,value:e.value}}function Rn(e){e in fc&&(On(fc[e]),delete fc[e])}function kn(){for(var e in fc)fc.hasOwnProperty(e)&&Rn(e)}function Cn(e,t){if(!(t.$k in fc)){var n={key:t.$k,model:t.$m,pk:Ct(e),pkType:1===t.$m.pks.length?xi:Gi,title:Ge(e.__model__),type:pu,value:e,fetched_at:(new Date).getTime()};rr(n),fc[t.$k]=n}}function On(e){lu===e.type?Dn(e):pu===e.type&&or(e)}function Ln(e){return fc[e]}function Vn(e){var t=[];for(var n in fc){var r=fc[n];pu===r.type&&e===r.model.name&&t.push(r.value)}return t}function In(e){if(!e.registered){l(y.EVENT_INSTANCE_CREATE,e.model.name,Pn,e),l(y.EVENT_INSTANCE_CHANGE,e.model.name,Un,e),l(y.EVENT_INSTANCE_DELETE,e.model.name,jn,e);var t={};if(e.params)for(var n in t=Kn(e)){var r=t[n];l(y.EVENT_INSTANCE_CHANGE,r+":"+e.params[n],Mn,e),l(y.EVENT_INSTANCE_DELETE,r+":"+e.params[n],xn,e)}for(var n in e.model.fks)if(!(n in t)){r=e.model.fks[n];l(y.EVENT_INSTANCE_CREATE,r,Gn,e),l(y.EVENT_INSTANCE_CHANGE,r,Hn,e),l(y.EVENT_INSTANCE_DELETE,r,qn,e)}e.registered=!0}}function Dn(e){if(e.registered){d(y.EVENT_INSTANCE_CREATE,e.model.name,e),d(y.EVENT_INSTANCE_CHANGE,e.model.name,e),d(y.EVENT_INSTANCE_DELETE,e.model.name,e);var t={};if(e.params)for(var n in t=Kn(e)){var r=t[n];d(y.EVENT_INSTANCE_CHANGE,r+":"+e.params[n],e),d(y.EVENT_INSTANCE_DELETE,r+":"+e.params[n],e)}for(var n in e.model.fks)if(!(n in t)){r=e.model.fks[n];d(y.EVENT_INSTANCE_CREATE,r,e),d(y.EVENT_INSTANCE_CHANGE,r,e),d(y.EVENT_INSTANCE_DELETE,r,e)}e.registered=!1}}function Pn(e,t){zn(e,t)&&Qn(e,t)}function Un(e,t,n){var r=zn(e,t),o=e.value.contains(t);if(!r&&o)er(e,t);else if(r&&!o)Qn(e,t);else if(o){var a=Ue(Si,e.model.name);a&&tr(e,a,n)}}function jn(e,t){e.value.contains(t)&&er(e,t)}function Mn(e,t,n){var r=Ue(wi,e.model.name,t);!r||e.value.length&&!Xn(e,t)||tr(e,r,n)}function xn(e,t){e.value.length&&!Xn(e,t)||(p(y.EVENT_LIST_RESOURCE_DELETE,e.key,e),Rn(e))}function Gn(e,t){var n=Ue($i,e.model.name,t);n&&Wn(n)&&nr(e,!0)}function Hn(e,t,n){var r=Ue($i,e.model.name,t);r&&(!e.value.length||Yn(e,t)||Wn(r))&&tr(e,r,n)}function qn(e,t){if(e.value.length&&!Yn(e,t)){var n=Ue($i,e.model.name,t);n&&Wn(n)&&nr(e,!0)}else nr(e,!0)}function zn(e,t){if(e.params)for(var n in e.params){if(n in t)return Zn(e,t,n);if(!Bn(e.params[n],Pe(t,n)))return!1}return!0}function Zn(e,t,n){return u(t[n])?Fn(e,t,n):!!Bn(e.params[n],t[n])}function Fn(e,t,n){var r=ct(t).$m.def[n].fk;return r?Jn(e,t,n,Je(r)):(ju("Setu.lists !Ïµ - field in instance is an object however it was not defined as a foreign key",t,n,e),!1)}function Jn(e,t,n,r){if(1===r.pks.length){if(!Bn(e.params[n],t[n]&&t[n][r.pks[0]]))return!1}else{var o=Ot(e.params[n]);for(var a in o)if(!Bn(o[a],t[n]&&t[n][a]))return!1}return!0}function Bn(e,t){try{if("string"==typeof t)return e===t;var n=c(y.ADAPTER_FILTER_VALUE,e);return eval(n[0])===t}catch(e){return!1}}function Kn(e){var t={};for(var n in e.params)n in e.model.fks&&(t[n]=e.model.fks[n]);return t}function Xn(e,t){var n=!1,r=e.model.def;for(var o in e.params)if(r[o]&&r[o].fk===t.__model__&&Ct(t).toString()===e.params[o]){n=!0;break}return n}function Yn(e,t){var n,r=t.__model__;for(var o in e.model.fks)if(r===e.model.fks[o]){n=o;break}if(!n)return!1;for(var a=0;a<e.value.length;++a){var i=e.value[a];if(i[n]===Ct(t))return!0}return!1}function Wn(e){return"always"===e.__trigger__}function Qn(e,t){e.value.unshift(t),1<e.value.length?nr(e):N(y.EVENT_LIST_RESOURCE_CREATE,e)}function er(e,t){e.value.remove(t),nr(e)}function tr(e,t,n){var r=!1;if(!0===t)r=!0;else for(var o in n)if(o in t){r=!0;break}r&&nr(e,!0)}function nr(t,e){if(e){var n=t.key.match(Ri),r=Setu.pageSizeParam||Setu.PAGE_SIZE_PARAM,o=t.params[r];ln(n,t),o&&(t.params[r]=o),pn(t)}An(t,function(e){Oo(t),p(y.EVENT_LIST_RESOURCE_CHANGE,t.key,t)})}function rr(e){if(!e.registered){var t=ct(e.value).$k;l(y.EVENT_INSTANCE_CHANGE,t,ar,e),l(y.EVENT_INSTANCE_DELETE,t,ir,e),e.registered=!0}}function or(e){if(e.registered){var t=ct(e.value).$k;d(y.EVENT_INSTANCE_CHANGE,t,e),d(y.EVENT_INSTANCE_DELETE,t,e),e.registered=!1}}function ar(e,t,n){p(y.EVENT_DETAIL_RESOURCE_CHANGE,e.key,e,n)}function ir(e){p(y.EVENT_DETAIL_RESOURCE_DELETE,e.key,e)}function ur(){return pc}function cr(e){var t=location.protocol+"//"+location.host,n=new EventSource(t+e);n.addEventListener("created",fr),n.addEventListener("updated",sr),n.addEventListener("deleted",lr),pc=!0}function fr(){try{var t=JSON.parse(e.data),n=t.model+":"+t.pk;if(fc[n])return;pr(n)}catch(e){}}function sr(e){try{var t=JSON.parse(e.data),n=t.model+":"+t.pk,r=fc[n];if(r){if(r.fetched_at>=t.timestamp)return;yn(r)}else pr(n)}catch(e){}}function lr(){try{var t=JSON.parse(e.data),n=t.model+":"+t.pk,r=fc[n];if(!r)return;var o=r.value,a=ct(o);p(y.EVENT_INSTANCE_DELETE,a.$k,o),p(y.EVENT_INSTANCE_DELETE,o.__model__,o),Gt(o)}catch(e){}}function pr(e){Tn(on(e),function(e){var t=e.value;Object.keys(t).length&&p(y.EVENT_INSTANCE_CREATE,t.__model__,t)})}function Er(e){return Ya in e||(++dc,e[Ya]=dc,Ec[e[Ya]]={}),dr(e)}function dr(e){return Ec[e[Ya]]}function _r(e){mr(e)&&(delete Ec[e[Ya]],delete e[Ya])}function mr(e){return Ya in e}function vr(e){var t=Er(e);if(gr(t),!Object.keys(t.$p.$n).length)for(var n=e.parentNode;n&&!ja(n);){var r=dr(n);if(r&&r.$p&&r.$p.$n)return void Sr(r,t);n=n.parentNode}return t}function hr(e,t,n,r){Ar(e,t);var o=dr(t);o.$p.$c={},o.$p.$c[n]=r,o.$p.$n[n]=r,o.$p.$l=!0}function Ar(e,t){var n=Er(t),r=dr(e);gr(n),Sr(r,n),wr(r,n)}function Tr(e,t,n){if(t.$p.$o){var r=t.$p.$o,o=dr(r),a=dr(n);o.$p.$i.remove(e),o.$p.$i.push(n),a.$p.$o=r}}function yr(e,t){var n=t.$p.$o;n&&dr(n).$p.$i.remove(e);delete t.$p.$o}function Nr(e){for(;e&&!ja(e);){var t=dr(e);if(t.$p&&t.$p.$c)for(var n in t.$p.$c)return t.$p.$c[n];if("form"===e.tagName.toLowerCase()&&e.hasAttribute(Xi)){var r=Ln(e.getAttribute(Xi));if(r)return r.value}e=e.parentNode}return null}function gr(e){e.$p=e.$p||{},e.$p.$n=e.$p.$n||{}}function Sr(e,t){for(var n in e.$p.$n)t.$p.$n[n]=e.$p.$n[n]}function wr(e,t){var n=e.$p.$n;for(var r in delete e.$p.$n,e.$p)t.$p[r]=e.$p[r];e.$p.$n=n}function $r(){_c={},mc=0}function br(e){var t=mc++;return _c[t]=e,t}function Rr(e){return _c[e]}function kr(e){delete _c[e]}function Cr(e,t){var n=qr(e);n.innerHTML=t;for(var r=Array.prototype.slice.call(n.childNodes);n.childNodes.length;)e.parentNode.insertBefore(n.childNodes[0],e);return Lr(e),r}function Or(e){var t=dr(e);if(!t||!t.$p)throw ju("Setu.elements !","internal error while trying to eval binds",e),new Error(Ru);var n=t.$p,r=jr(e,n.$t);e.parentNode.insertBefore(r.childNodes[0],e);var o=e.previousSibling;return Ar(e,o),Tr(e,t,o),n.$c&&(dr(o).$p.$c=n.$c),Lr(e),o}function Lr(e){_r(e),document.body.contains(e)&&e.parentNode.removeChild(e)}function Vr(e){var t=dr(e).$p,n=document.createComment(Ir(e,t));return Er(n).$p=t,e.parentNode.insertBefore(n,e),Lr(e),n}function Ir(e,t){return uu+":"+br(t.$t||e.outerHTML)}function Dr(e){if(e&&document.body.contains(e)){var t=Mr(e),n=dr(e).$p;n.$i&&(n.$i.forEach(function(e){Lr(e)}),delete n.$i);var r=Er(t);return r.$p=n,_r(e),e.parentNode.removeChild(e),t}}function Pr(e){return Hr(e,Ur(e))}function Ur(e){var t=dr(e);if(!t||!t.$p||!t.$p.$t)throw ju("Setu.elements ! template-to-node",e,t),new Error(Ru);return t.$p.$t}function jr(e,t){var n=qr(e);return n.innerHTML=t,n}function Mr(e){var t=xr(e),n=Hr(e,Rr(t));return kr(t),e.parentNode.insertBefore(n,e),n}function xr(e){return parseInt(e.textContent.replace(/^.*:/g,""),10)}function Gr(e){return Hr(e,Rr(xr(e)))}function Hr(e,t){var n=qr(e);return n.innerHTML=t,n.firstChild}function qr(e){var t=e.parentNode.tagName.toLowerCase();return"body"===t&&(t="div"),document.createElement(t)}function zr(e){return Kr(e)||Jr(e)||Zr(e)}function Zr(e){return 0!=Fr(e)}function Fr(e){return e.querySelectorAll(Ou).length}function Jr(e){return Br(e.outerHTML)}function Br(e){return e.match(ki)||e.match(Ci)}function Kr(e){for(var t=0;t<iu.length;++t)if(e.hasAttribute(iu[t]))return!0;return!1}function Xr(e){var t=e.getAttribute(zi);return t?_u===t?{type:t}:{type:hu,code:t}:null}function Yr(e){if(e.hasAttribute(Wi))return{type:mu,model:Je(e.getAttribute(Wi))};if(e.hasAttribute(Xi)){var t=e.getAttribute(Xi),n=on(dr(e).$p.$n,t);if(pu!==n.type)throw ju("Setu.meta !","invalid instance resource key",t,e),new TypeError(bu);return{type:vu,resource:n}}return null}function Wr(e){return eo(e,qi)}function Qr(e){return eo(e,eu)}function eo(e,t){if(!e.hasAttribute(t))return[];for(var n=e.getAttribute(t).split(","),r=0;r<n.length;++r){dr(e)||ju("Setu.meta !","element not init before parsing res list",e);var o=on(dr(e).$p.$n,n[r]);if(!vc.contains(o.type))throw ju("Setu.meta !","invalid key",t,n[r],e),new TypeError(bu);n[r]=o}return n}function to(e,t){if(e.hasAttribute(qi)){var n=new RegExp("[,]?"+no(t)+"[,]?");return!!e.getAttribute(qi).match(n)}return!1}function no(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function ro(){hc=[]}function oo(e){hc.push(e)}function ao(){return hc}function io(e){hc=e}function uo(){ro(),$r(),Ac=0,Tc=!1}function co(){return 0===Ac}function fo(){ma(),Ta(),N(y.EVENT_META_RENDER,y),Tc||(Tc=!0,N(y.EVENT_PAGE_RENDER,y),!ur()&&nc&&nc.instanceEventStream&&cr(nc.instanceEventStream))}function so(e){y.appOnParseBegin&&y.appOnParseBegin("setu"),++Ac}function lo(e){--Ac,y.appOnParseEnd&&y.appOnParseEnd(),po()}function po(){W()||Fo()||!co()||fo()}function Eo(e,t){if(document.body.contains(e)){t||so(e),vr(e);var n=dr(e);switch(_o(e,n.$p,n.$p.$n)){case Nu:case yu:return;case gu:case Su:break;case Tu:bo(e,n)}lo(e)}}function _o(r,o,a){if(Jr(r)&&mo(r,a),r.hasAttribute(Ki)){var i=r.getAttribute(Ki).trim();if(!yc[i])return z(r.getAttribute(Ki).trim(),{},function(e){yc[i]=e.data;$_(r).index();var t=r.parentNode,n=vo(r,o,a,e.data);document.body.contains(r)?Eo(r,!0):(To(t,n,a),lo(r))},function(e){var t=JSON.parse(e.message);N(y.EVENT_AJAX_ERROR,null,{status:t.status,error:t.error})}),yu;var e=$_(r).index(),t=r.parentNode,n=vo(r,o,a,yc[i]);if(!document.body.contains(r))return To(t,n,a),Su}if(r.hasAttribute(eu)){var u,c=Qr(r);if(!(u=nn(c)))return yo(r,o,a,c),yu;for(var f in u)a[f]=u[f]}if(r.hasAttribute(qi)&&!o.$t&&!r.hasAttribute(Yi)){var s=r.getAttribute(qi);Br(s)&&r.setAttribute(qi,g(a,s)),o.$t=r.outerHTML}if(r.hasAttribute(Yi)){if(null===(h=r.getAttribute(Yi).trim().match(Li)))return Nu;f=h[1];var l,p=h[2];try{l=$(a,p)}catch(e){return ju("Setu.parser !",Yi,h[2],r,o,e.message,e.stack),Nu}if(!l)return ju("Setu.parser !",Yi,h[2],r,o,l),Nu;a[p]=l;var E=No(r,o,f,l),d=Vr(r);return So(d,E),oo(d),E.slice().forEach(function(e){Eo(e)}),gu}if(r.hasAttribute(Bi)){var _=r.getAttribute(Bi).trim(),m=!1;try{m=$(a,_)}catch(e){return ju("Setu.parser !",Bi,_,r,o,e.message,e.stack),Nu}if(!m)return o.$l?(yr(r,dr(r)),Lr(r)):(r.hasAttribute(qi)&&ko(r),oo(Vr(r))),gu}if(r.hasAttribute(Ji)){var v=r.getAttribute(Ji).split(";");for(e=0;e<v.length;++e){if(null===(h=v[e].trim().match(Vi)))return Nu}for(e=0;e<v.length;++e){var h,A=(h=v[e].trim().match(Vi))[1],T=h[2];try{T=$(a,T),a[A]=T}catch(e){return ju("Setu.parser !",Ji,A,h[2],r,o,e.message,e.stack),Nu}}}Jr(r)&&(mo(r,a),Br(r.innerHTML)&&Array.prototype.slice.call(r.childNodes).forEach(function(e){qa===e.nodeType&&Br(e.textContent)&&wo(e,r,a)}));return $o(r),Tu}function mo(e,t){for(var n=0;n<e.attributes.length;++n){var r=e.attributes[n];Br(r.value)&&(r.value=g(t,r.value))}}function vo(e,t,n,r){var o;return X(),e.hasAttribute(tu)?o=ho(e,t,n,r):Ao(e,t,n,r),K(kc),o}function ho(e,t,n,r){return Cr(e,r)}function Ao(e,t,n,r){e.innerHTML=r,e.removeAttribute(Ki)}function To(t,e,n){e.forEach(function(e){Ha===e.nodeType?Eo(e):qa===e.nodeType&&Br(e.textContent)&&wo(e,t,n)})}function yo(n,e,r,t){rn(t,{},function(e){for(var t in e)r[t]=e[t];Eo(n,!0)})}function No(e,t,n,r){X();var o=go(e,r),a=r.length,i=jr(e,o),u=Array.prototype.slice.call(i.childNodes);for(idx=0;idx<a;++idx){var c=r[idx],f=i.childNodes[0];hr(e,f,n,c),e.parentNode.insertBefore(f,e)}return K(kc),u}function go(e,t){var n,r=e.getAttribute(Yi);e.removeAttribute(Yi);var o="",a=t.length;for(n=0;n<a;++n)o+=e.outerHTML;return e.setAttribute(Yi,r),o}function So(t,e){(dr(t).$p.$i=e).forEach(function(e){dr(e).$p.$o=t})}function wo(e,t,n){var r=g(n,e.textContent.trim()).trim(),o=document.createElement("div");for(o.innerHTML=r;o.childNodes.length;)t.insertBefore(o.childNodes[0],e);t.removeChild(e)}function $o(e){Array.prototype.slice.call(e.childNodes).forEach(function(e){e.nodeType===Ha&&zr(e)&&Eo(e)})}function bo(e,t){if(e.hasAttribute(zi)&&da(e,t),e.hasAttribute(ru)?va(e):e.hasAttribute(ou)?ha(e):e.hasAttribute(au)&&Aa(e),"form"===e.tagName.toLowerCase())Jo(e,t);else if("select"===e.tagName.toLowerCase())Xo(e);else if("option"===e.tagName.toLowerCase()){for(var n=e.parentNode;n&&"select"!==n.tagName.toLowerCase();)n=n.parentNode;n&&!$_(e).next()&&Xo(n)}e.hasAttribute(qi)&&ko(e,t)}function Ro(){gc=!(Nc={}),$c=!(Sc=[])}function ko(e,t){Co(Wr(e))}function Co(e){e.forEach(function(e){Oo(e)})}function Oo(e){var t=e.key;t in Nc||(Lo(t,e.type),Nc[t]=!0)}function Lo(e,t){pu===t?(l(y.EVENT_DETAIL_RESOURCE_CHANGE,e,function(e,t,n){Vo({handler:Do,resource:t,data:n})},wc),l(y.EVENT_DETAIL_RESOURCE_DELETE,e,function(e,t){Vo({handler:Po,resource:t})},wc)):lu===t&&(l(y.EVENT_LIST_RESOURCE_CHANGE,e,function(e,t){Vo({handler:jo,resource:t})},wc),l(y.EVENT_LIST_RESOURCE_DELETE,e,function(e,t){Vo({handler:Mo,resource:t})},wc))}function Vo(e){Sc.push(e),Io()}function Io(e){if($c){if(!e)return}else $c=!0;for(;Sc.length;){var t=Sc.shift();if(t.handler(i,t.resource,t.data),!co())return void f(y.EVENT_META_RENDER,function(){Io(!0)},wc)}$c=!1,E(y.EVENT_META_RENDER,wc)}function Do(e,t,n){var r=t.key,o=qo(Ho(r));for(var a in n)n.hasOwnProperty(a)&&Array.prototype.push.apply(o,zo(r));Zo(o)}function Po(e,t){xo(t.key)}function Uo(e,t){Go(t)}function jo(e,t){Go(t)}function Mo(e,t){xo(t.key)}function xo(e){var t=Ho(e);t.forEach(function(e){Lr(e)})}function Go(e){var t=e.key,n=qo(Ho(t));Array.prototype.push.apply(n,zo(t)),Zo(n)}function Ho(t){var e=Ma("["+qi+"]"),n=[];return e.forEach(function(e){if(to(e,t)){dr(e);n.push(e)}}),n}function qo(e){var t=[];return X(),e.forEach(function(e){document.body.contains(e)&&t.push(Or(e))}),K(kc),t}function zo(t){var n=[],r=[];return X(),ao().forEach(function(e){document.body.contains(e)&&(to(Gr(e),t)?n.push(Dr(e)):r.push(e))}),io(r),K(kc),n}function Zo(e){gc=!0,e.forEach(function(e){Eo(e)}),gc=!1,po()}function Fo(){return gc}function Jo(e,t){document.body.contains(e)&&!t.$f&&f(y.EVENT_META_RENDER,Bo,e)}function Bo(t){E(y.EVENT_META_RENDER,t),Ko(t);var e=Yr(t);if(e){var n=dr(t);switch(e.type){case mu:Yo(t,n,Ke(e.model));break;case vu:var r;(r=nn([e.resource]))?Yo(t,n,r[Object.keys(r)[0]]):rn([e.resource],{},function(e){Yo(t,n,e[Object.keys(e)[0]])})}}}function Ko(e){e.querySelectorAll("select").forEach(function(e){Xo(e)})}function Xo(e){if(e.hasAttribute("value")){var t=e.getAttribute("value");if(n=e.querySelector('option[value="'+t+'"]'))return void(e.value=n.value)}var n;(n=e.querySelector("option[selected]"))&&(e.value=n.value)}function Yo(t,e,n){e.$i=n;var r="function"==typeof t.onsubmit?t.onsubmit:null,o=Wo(t,e);t.onsubmit=r?function(){var e=r();return ta(t).length?o()&&e:e&&o()}:o,e.$f=!0}function Wo(n,r){return function(){if(n.hasAttribute(fu))return!1;try{var t=ta(n);return Qo(n,t)&&(ra(n,r),ia(n,r,t),sa(n,r),Kt(r.$i,function(e){la(n,r,t),N(y.EVENT_FORM_SUCCESS,n,e)},function(e){ju("Setu.forms ! form-submit",n),la(n,r,t),N(y.EVENT_FORM_ERROR,n,e)})),!1}catch(e){return!1}}}function Qo(e,t){var n=ea(e);return(e.error||e.getAttribute("error"))&&(n=!1),na(t)&&n}function ea(e){return!c(y.ADAPTER_VALIDATE_FORM,e).contains(!1)}function ta(e){return e.getAttribute("name")?document.querySelectorAll('form[foreign-key="'+e.getAttribute("name")+'"]'):[]}function na(e){var t,n=0;for(t=0;t<e.length;++t){var r=e[t],o=r.onsubmit;r.onsubmit=function(){return o(),!1},r.onsubmit(),r.onsubmit=o,r.error||r.hasAttribute("error")?++n:ea(r)||++n}return!n}function ra(e,t){for(var n=e.elements,r={},o=Ea(t),a=0;a<n.length;++a){var i=n[a],u=i.getAttribute(bc);u&&u in o.def&&(r[u]=oa(o.name,u,o.def[u],i.value),""===r[u]&&o.def[u].blankIsNull&&(r[u]=null))}_t(o.name,o.def,r,t.$i),c(y.ADAPTER_TUNE_INSTANCE,e,t.$i)}function oa(e,t,n,r){var o=ye(e,t,n);switch(o){case Ni:return aa(n.type,r);case gi:return""===r&&n.blankIsNull?null:aa(n.type,r);case yi:if(""===r&&n.blankIsNull)return null;var a=Je(n.fk),i=a.pks[0];return oa(a.name,i,a.def[i],r);case Ti:return eval(r)}}function aa(e,t){return Rc.contains(e)?t:eval(t)}function ia(e,t,n){n.length&&ua(e,t,n[0].getAttribute(fu));for(var r=0;r<n.length;++r){var o=n[r],a=dr(o);ra(o,a),fa(o,a,e,t)}}function ua(e,t,n){var r=Ea(t),o=r.def[n],a=t.$i;ca(r.name,n,o)?(a[n].splice(0,a[n].length),a[n]=[]):a[n]=i}function ca(e,t,n){var r=ye(e,t,n);if(Ti!==r)return!1;var o=Ce(e,t,n.elements);return yi==o}function fa(e,t,n,r){var o=e.getAttribute(fu),a=t.$i,i=ct(a),u=r.$i,c=ct(u),f=i.$d?Dt(a,i):Vt(a,i);f&&(i.$d&&i.$m.pks.forEach(function(e){f[e]=a[e]}),s(u[o])?c.$d?c.$c[o].newVal.push(f):u[o].push(f):u[o]=f)}function sa(e,t){e.hasAttribute(nu)&&(ct(t.$i).$qp=e.getAttribute(nu))}function la(e,t,n){if(e.hasAttribute(Wi)){pa(t);for(var r=0;r<n.length;++r){var o=n[r],a=dr(o);o.hasAttribute(Wi)&&pa(a)}}}function pa(e){e.$i=Ke(Ea(e))}function Ea(e){return Je(e.$i.__model__)}function da(e,t){if(!t.$c){var n=Xr(e);if(null===n)throw ju("Setu.clicks ! invalid",zi,e.getAttribute(zi),e),new Error(bu);_a(n,e),t.$c=!0}}function _a(t,o){switch(t.type){case _u:$_(o).onclick(function(e){a(e);var t=Nr(o);if(!t)throw ju("Setu.clicks ! cannot find context",o.getAttribute(zi),o),new Error(bu);var n=null,r=null;if(o.hasAttribute(Zi))try{n=eval(o.getAttribute(Zi))}catch(e){}if(o.hasAttribute(Fi))try{r=o.getAttribute(Fi),r=eval(r)}catch(e){}en(t,n,r)});break;case hu:$_(o).onclick(function(e){a(e),eval(t.code)})}}function ma(){Ma("a[href]").forEach(function(t){var e=Er(t);if(e.$l)return!0;ne(t.getAttribute("href").replace(/\?.*$/,""))&&$_(t).onclick(function(e){return a(e),$a(t.getAttribute("href")),!1}),e.$l=!0})}function va(e){var t=ga(e,ru),n=Setu.pageSizeParam||Setu.PAGE_SIZE_PARAM;$_(e).onchange(function(){ya(t,n,parseInt($_(e).value(),10))}),Na(t,e,n)}function ha(e){var r=ga(e,ou),o=(Setu.pageSizeParam||Setu.PAGE_SIZE_PARAM,Setu.pageParam||Setu.PAGE_PARAM),t=1<r.page?1:null,n=2<r.page?r.page-2:null,a=1<r.page?r.page-1:null,i=r.last?null:r.page+1,u=!r.last&&r.count>(1+r.page)*r.value.length?r.page+2:null,c=r.last?null:r.count%r.value.length?r.count/r.value.length+1:r.count/r.value.length,f="";f+=t?"<a begin-sym enabled page=1>&laquo;</a>":"<a begin-sym disabled>&laquo;</a>",f+=a?"<a prev-sym enabled page="+a+">&lt;</a>":"<a prev-sym disabled>&lt;</a>",f+=n?"<a prev-prev enabled page="+n+">"+n+"</a>":"",f+=a?"<a prev enabled page="+a+">"+a+"</a>":"",f+="<a current disabled>"+r.page+"</a>",f+=i?"<a next enabled page="+i+">"+i+"</a>":"",f+=u?"<a next-next enabled page="+u+">"+u+"</a>":"",f+=i?"<a next-sym enabled page="+i+">&gt;</a>":"<a next-sym disabled>&gt;</a>",f+=c?"<a end-sym enabled page="+c+">&raquo;</a>":"<a end-sym disabled>&raquo;</a>",e.querySelectorAll("a").forEach(function(e){e.parentNode.removeChild(e)}),X(),$_(e).append(f),K(kc),e.querySelectorAll("a[enabled][page]").forEach(function(n){$_(n).onclick(function(e){var t=parseInt(n.getAttribute("page"),10);r.params=r.params||{},r.params[o]=t,pn(r),nr(r)})})}function Aa(e){var t=ga(e,au);if(!e.hasAttribute(cu))throw ju("Setu.list-modifiers ! invalid meta: no",cu,au,e),new Error(bu);var n=e.getAttribute(cu);$_(e).onchange(function(){ya(t,n,$_(e).value())})}function Ta(){Ma("["+au+"]["+cu+"]").forEach(function(e){var t=ga(e,au),n=e.getAttribute(cu);Na(t,e,n)})}function ya(e,t,n){var r=Setu.pageParam||Setu.PAGE_PARAM;e.params=e.params||{},n?e.params[t]=n:delete e.params[t],delete e.params[r],pn(e),nr(e)}function Na(e,t,n){e.params[n]?$_(t).value(e.params[n].toString()):"select"===t.tagName.toLowerCase()&&Xo(t)}function ga(e,t){var n,r=eo(e,t);if(1!==r.length)throw ju("Setu.list-modifiers ! invalid meta",t,e),new Error(bu);if(!(n=Ln(r[0].key)))throw ju("Setu.list-modifiers ! resource not available",t,e,r),new Error(Ru);if(lu!==n.type)throw ju("Setu.list-modifiers ! resource is not a list",t,e,n),new Error(bu);return n}function Sa(e,t){if(!(kc=document.querySelector("["+Hi+"]")))throw ju("Setu.application","no element with",Hi,"attribute defined"),new TypeError(wu);Cc=e,Oc=kc.innerHTML,Ee(t.config||{}),Q(t.routes||{}),Ze(t.models,t.modelFilters,t.config&&t.config.models),tn(t.resources||{}),Ra()}function wa(){Pa(),Ra()}function $a(e){V(e),Ra()}function ba(e){I(e),Ra()}function Ra(){ka(),Oa()}function ka(){var e=de();u(e)&&"resources"in e&&e.resources.forEach(Rn),te(),uo(),Ro(),_(),j(),Ca()}function Ca(){kc.innerHTML=Oc}function Oa(){ee(function(){ie()?ue()?ba(ce()):fe()?La():Ua():Ua()})}function La(){var t=se();v({queryparams:Va()}),le()&&Pa(),rn(pe()||[],{},function(e){v(e),K(kc),Ia(t)})}function Va(){var n={};window.location.search&&window.location.search.replace(/^\?/,"").split("&").forEach(function(e){var t=e.split("=");n[decodeURIComponent(t[0])]=decodeURIComponent(t[1])});return n}function Ia(t){yc[t]?Da(yc[t]):z(t,{},function(e){Da(e.data),yc[t]=e.data},function(e){var t=JSON.parse(e.message);N(y.EVENT_AJAX_ERROR,null,{status:t.status,error:t.error})})}function Da(e){kc.innerHTML=e+Oc,kc.querySelectorAll(Ou).length||fo()}function Pa(){kn()}function Ua(){K(kc),kc.querySelectorAll(Ou).forEach(function(e){Eo(e)}),co()&&fo()}function ja(e){return kc===e}function Ma(e){return kc.querySelectorAll(e)}if(Array.prototype.contains=function(e){return-1!==this.indexOf(e)},Array.prototype.remove=function(e,t){var n;-1!==(n=this.indexOf(e))&&this.splice(n,t||1)},Object.keys=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(n[a]=o[a])}return n},writable:!0,configurable:!0}),"function"!=typeof document.querySelector)throw ju("Setu.env ! document.querySelector not supported"),new Error(ku);if("function"!=typeof document.querySelectorAll)throw ju("Setu.env ! document.querySelectorAll not supported"),new Error(ku);if(!window.history||"function"==typeof!window.history.pushState||"function"==typeof!window.history.popState)throw ju("Setu.env ! no support for browsing history update"),new Error(ku);var xa=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;if(!xa)throw ju("Setu.env ! no MutationObserver support in browser"),new Error(ku);if("function"!=typeof Object.create)throw ju("Setu.env ! Object.create not supported"),new Error(ku);var Ga="application/json; charset=UTF-8",Ha=1,qa=3,za=8,Za="GET",Fa="POST",Ja="PATCH",Ba="PUT",Ka="DELETE",Xa=["__model__","__key__"],Ya="__sc",Wa="auto",Qa="fk",ei="elements",ti="null",ni="optional",ri="blankIsNull",oi="pk",ai="type",ii="boolean",ui="date",ci="datetime",fi="decimal",si="integer",li="string",pi="time",Ei="uuid",di=[ri,Qa,ti],_i=[ii,ui,ci,fi,si,li,pi,Ei],mi=[ri,ti,ni,ai],vi=[Wa,oi,ai],hi=[ri,ei,ni,ai],Ai=[ti,ai],Ti="array",yi="fk",Ni="pk",gi="primitive",Si="fields",wi="filters",$i="instanceFks",bi="relFilters",Ri=/^({([a-z][0-9a-zA-Z_]*)})?([A-Za-z][0-9a-zA-Z_]+)(:(([^,:|=]+)|([a-z][0-9a-zA-Z_]*=[^;:|=]+(;[a-z][0-9a-zA-Z_]*=[^;:|]+)*)))?(\|([a-z][0-9a-zA-Z_]*=[^;=]+(;[a-z][0-9a-zA-Z_]*=[^;=]+)*))?$/,ki=/({{[^{}]+}})/g,Ci=/({%{[^{}]+}%})/g,Oi=/^setu\-([a-z])([a-z]+)$/,Li=/([a-zA-Z][a-zA-Z0-9_\.]*)[\s]*in[\s]*([a-zA-Z][a-zA-Z0-9_\.]+)/,Vi=/([a-zA-Z][a-zA-Z0-9_]*)[\s]*=[\s]*(.*)+/,Ii=/^list::([A-Za-z][A-Za-z0-9_]+)(\|([a-z][0-9a-zA-Z_]*=[^,=]+(,[a-z][0-9a-zA-Z_]*=[^,=]+)*))?$/,Di=/^create::([A-Z][A-Za-z0-9_]+)$/,Pi=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,Ui=/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01])[T ](0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?(\.\d+)?(Z|[+-](0\d|1[0-2]):?[0-5]\d)?$/,ji=/^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12]\d|3[01])$/,Mi=/^(0\d|1\d|2[0-3]):[0-5]\d(:[0-5]\d)?(\.\d+)?(Z|[+-](0\d|1[0-2]):?[0-5]\d)?$/,xi="one",Gi="multi",Hi="setu-app",qi="setu-bind",zi="setu-click",Zi="setu-delete-callback",Fi="setu-delete-param",Ji="setu-declare",Bi="setu-if",Ki="setu-include",Xi="setu-instance",Yi="setu-loop",Wi="setu-model",Qi="setu-pass",eu="setu-require",tu="setu-replace",nu="setu-params",ru="setu-pagesize",ou="setu-pageset",au="setu-filter",iu=[qi,zi,Ji,Bi,Ki,Xi,Yi,Wi,Qi,eu,ru,ou,au],uu="setu-content",cu="filter-param",fu="related-as",su="api",lu="list",pu="detail",Eu="create",du="update",_u="delete",mu="model",vu="instance",hu="code",Au="parseFallThrough",Tu="parseDone",yu="parsePending",Nu="parseError",gu="parseRemoved",Su="parseReplaced",wu="Improperly configured Setu application",$u="Invalid instance data",bu="Invalid Setu meta syntax",Ru="Setu internal error",ku="This browser does not support the Setu framework",Cu=[];iu.forEach(function(e){Cu.push("["+e+"]")});var Ou=Cu.join(",");y.MULTI_PK_TO_URL_KEY_VALUE_PATH="KeyValuePath",y.MULTI_PK_TO_URL_ORDERED_VALUES_PATH="OrderedValuesPath",y.MULTI_PK_TO_URL_ORDERED_SEPERATED_VALUES="OrderedSeparatedValues",y.EVENT_LIST_RESOURCE_CREATE="listResourceCreate",y.EVENT_LIST_RESOURCE_CHANGE="listResourceChange",y.EVENT_LIST_RESOURCE_DELETE="listResourceDelete",y.EVENT_DETAIL_RESOURCE_CHANGE="detailResourceChange",y.EVENT_DETAIL_RESOURCE_DELETE="detailResourceDelete",y.EVENT_INSTANCE_CHANGE="instanceChange",y.EVENT_INSTANCE_CREATE="instanceCreate",y.EVENT_INSTANCE_DELETE="instanceDelete",y.EVENT_META_RENDER="metaRender",y.EVENT_PAGE_BEGIN="pageBegin",y.EVENT_PAGE_RENDER="pageRender",y.EVENT_FRAGMENT_CHANGE="fragmentChange",y.EVENT_FORM_SUCCESS="formSuccess",y.EVENT_FORM_ERROR="formError",y.EVENT_AJAX_ERROR="ajaxError",y.ADAPTER_AJAX_BEFORE_SEND="ajaxBeforeSend",y.ADAPTER_AJAX_ON_RESPONSE="ajaxOnResponse",y.ADAPTER_MODELS_LIST="modelsList",y.ADAPTER_FILTER_VALUE="filterValue",y.ADAPTER_VALIDATE_FORM="__forms__validate",y.ADAPTER_TUNE_INSTANCE="tuneInstance",y.PAGE_PARAM="page",y.PAGE_SIZE_PARAM="page_size";var Lu={error:1,warn:2,info:3,log:4},Vu=Lu.log;console.debug=console.debug||n,console.time=console.time||n,console.timeEnd=console.timeEnd||n;var Iu=console.time||n,Du=console.timeEnd||n,Pu=console.info||n,Uu=console.warn||n,ju=console.error||n,Mu={};y.adapters={};var xu={},Gu={};xu[y.EVENT_LIST_RESOURCE_CREATE]=[],xu[y.EVENT_FORM_SUCCESS]=[],xu[y.EVENT_FORM_ERROR]=[],xu[y.EVENT_AJAX_ERROR]=[],xu[y.EVENT_PAGE_RENDER]=[],xu[y.EVENT_PAGE_BEGIN]=[],xu[y.EVENT_META_RENDER]=[],xu[y.EVENT_FRAGMENT_CHANGE]=[],Gu[y.EVENT_DETAIL_RESOURCE_CHANGE]={},Gu[y.EVENT_DETAIL_RESOURCE_DELETE]={},Gu[y.EVENT_INSTANCE_CHANGE]={},Gu[y.EVENT_INSTANCE_CREATE]={},Gu[y.EVENT_INSTANCE_DELETE]={},Gu[y.EVENT_LIST_RESOURCE_CHANGE]={},Gu[y.EVENT_LIST_RESOURCE_DELETE]={},y.register=f,y.unregister=E;var Hu=window,qu={},zu;y.set=function(e,t){m(e,t),h()};var Zu={datetime:b},Fu,Ju;window.onpopstate=function(e){e.state&&e.state.pathname&&(C(e.state,GLastUrl||{})?N(y.EVENT_FRAGMENT_CHANGE,y):(Fu=e.state,Ra()),U())},V(window.location.pathname+window.location.search+window.location.hash,{pathname:window.location.pathname,search:window.location.search,fragment:window.location.hash}),y.fragment=L;var Bu={},Ku=!1,Xu=new xa(function(e){Y(e)}),Yu,Wu,Qu,ec,tc,nc,rc;y.models={},y.models.NameResolutionDefault={m2p:function(e){return e.replace(/^([A-Z])/,function(e){return e.toLowerCase()}).replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})+"s"},p2m:function(e){return e.replace(/^([a-z])/,function(e){return e.toUpperCase()}).replace(/(-[a-z])/g,function(e){return e.charAt(1).toUpperCase()}).replace(/s$/,"")},m2i:function(e){return e.replace(/^([A-Z])/,function(e){return e.toLowerCase()}).replace(/([A-Z])/g,function(e){return"_"+e.toLowerCase()})},i2m:function(e){return e.replace(/^([a-z])/,function(e){return e.toUpperCase()}).replace(/(_[a-z])/g,function(e){return e.charAt(1).toUpperCase()})},m2l:function(e){return this.m2i(e)+"s"},l2m:function(e){return this.i2m(e).replace(/s$/,"")}};var oc={},ac={},ic=0,uc={},cc=0,fc,sc;y.imeta=pt;var lc={};y.get=rn,y.getByKey=Ln,y.getModelInstances=Vn,y.reloadList=nr,y.reloadDetail=yn;var pc=!1,Ec={},dc=0,_c={},mc=0,vc=[lu,pu,su],hc=[],Ac=0,Tc=!1,yc={},Nc={},gc=!1,Sc=[],wc="__gbpc__",$c=!1;f(y.EVENT_LIST_RESOURCE_CREATE,function(e,t){Vo({handler:Uo,resource:t})},wc);var bc="name",Rc=[li,ci,ui,pi,Ei],kc,Cc,Oc;y.run=Sa,y.refresh=wa,y.open=$a,y.clear=uo,y.app=kc}(window.Setu=window.Setu||{}),$_.ready(function(){Setu.adapters.Django=[{purpose:Setu.ADAPTER_AJAX_BEFORE_SEND,handler:function(e,t,n,r){if(!/^(GET|HEAD|OPTIONS|TRACE)$/.test(n.method)&&!r.crossDomain){var o=document.cookie.match(new RegExp("csrftoken=([^;]+)"));o&&t.setRequestHeader("X-CSRFToken",o[1])}}},{purpose:Setu.ADAPTER_FILTER_VALUE,handler:function(e,t){switch(t){case"True":return"true";case"False":return"false";case"None":return"null";default:return t}}}]}),$_.ready(function(){function a(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(e,t){for(var n=e.replace(/^[^\?]*\?/,"").split("&"),r=1,o=0;o<n.length;++o){var a=n[o].split("=");if(t===a[0]){r=parseInt(a[1],10);break}}return r}Setu.adapters.DjangoRestFramework=[{purpose:Setu.ADAPTER_MODELS_LIST,handler:function(e,t){if(data=t.data,function(e){return"object"==typeof e&&!a(e)}(data)){var n,r=Setu.pageParam||Setu.PAGE_PARAM,o=!1;return data.next?n=i(data.next,r)-1:o=(n=data.previous?i(data.previous,r)+1:1,!0),{page:n,last:o,count:data.count,list:data.results}}if(a(data))return{page:1,last:!0,count:data.length,list:data}}}]});